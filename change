// ==================== ë©”ì´í¬ìƒµ ì»¤í”Œë§ ê°€ê²© ìë™í™” ì‹œìŠ¤í…œ v3.3 ====================
// ì‘ì„±ì¼: 2024.12.30
// ê°œì„ ì¼: 2025.01.08
// ìˆ˜ì •ì¼: 2025.01.13 - ë²”ìœ„ ì§€ì • ì²˜ë¦¬ ë° ê°€ê²© ë³€ë™ë¥  ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€
// ìš©ë„: ì»¤í”Œë§ ìƒí’ˆì˜ 14K/18K Ã— ë‚¨ì/ì—¬ì/ì»¤í”Œ + 10K ì œí’ˆ ê°€ê²© ìë™ ë§¤ì¹­ ë° ê²€ì¦

// ========== ì„¤ì • ì˜ì—­ ==========
const CONFIG = {
  ì›ë³¸ë°ì´í„°ì‹œíŠ¸: 'ì›ë³¸ë°ì´í„°',
  ê°€ê²©ìˆ˜ì •ì‹œíŠ¸: 'ê°€ê²©ìˆ˜ì •íŒŒì¼',
  ë§¤ì¹­ê²°ê³¼ì‹œíŠ¸: 'ë§¤ì¹­ê²°ê³¼',
  ë³€ê²½ë‚´ì—­ì‹œíŠ¸: 'ê°€ê²©ë³€ê²½ê°ì§€',
  ë©”ì´í¬ìƒµì—…ë¡œë“œì‹œíŠ¸: 'ë©”ì´í¬ìƒµì—…ë¡œë“œ',
  ì˜µì…˜ê²€ì¦ì‹œíŠ¸: 'ì˜µì…˜ê°€ê²©ê²€ì¦',
  ë¯¸ë§¤ì¹­ì›ë³¸ì‹œíŠ¸: 'ë¯¸ë§¤ì¹­ì›ë³¸ìƒí’ˆ',
  ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸: '10kë°ì´í„°',
  ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸: '10kê°€ê²©ìˆ˜ì •íŒŒì¼',
  ë³€ë™ë¥ ê²€ì¦ì‹œíŠ¸: 'ê°€ê²©ë³€ë™ë¥ ê²€ì¦'
};

// ========== ë©”ë‰´ ìƒì„± ==========
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('ğŸ”§ ì»¤í”Œë§ ê°€ê²© ê´€ë¦¬')
    .addItem('ğŸ“Š ë²”ìœ„ ì§€ì • ê°€ê²© ê²€ì¦', 'validatePricesWithRange')
    .addItem('ğŸ“Š ì „ì²´ ê°€ê²© ê²€ì¦', 'validateAllPrices')
    .addItem('ğŸ“Š ê°€ê²© ë³€ê²½ì‚¬í•­ ì°¾ê¸°', 'findPriceChanges')
    .addItem('ğŸ“¥ ë©”ì´í¬ìƒµ ì—…ë¡œë“œ íŒŒì¼ ìƒì„±', 'createMakeshopUploadFile')
    .addItem('ğŸ’¹ ê°€ê²© ë³€ë™ë¥  ê²€ì¦', 'validatePriceChangeRatio')
    .addSeparator()
    .addItem('ğŸ“‹ ì‹œíŠ¸ ì •ë¦¬', 'organizeSheets')
    .addItem('ğŸ—‘ï¸ ë¶ˆí•„ìš”í•œ ì‹œíŠ¸ ì‚­ì œ', 'cleanupSheets')
    .addItem('ğŸ“Š ì „ì²´ ë¦¬í¬íŠ¸', 'generateFullReport')
    .addItem('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±', 'createTestData')
    .addToUi();
}

// ========== ë²”ìœ„ ì§€ì • ê°€ê²© ê²€ì¦ ==========
function validatePricesWithRange() {
  const ui = SpreadsheetApp.getUi();
  
  // ë²”ìœ„ ì…ë ¥ ë°›ê¸°
  const response = ui.prompt(
    'ê²€ì¦ ë²”ìœ„ ì§€ì •',
    'ê²€ì¦í•  ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n' +
    'ì˜ˆ: 1-100 (1ë²ˆë¶€í„° 100ë²ˆê¹Œì§€)\n' +
    'ì˜ˆ: 101-150 (101ë²ˆë¶€í„° 150ë²ˆê¹Œì§€)',
    ui.ButtonSet.OK_CANCEL
  );
  
  if (response.getSelectedButton() === ui.Button.CANCEL) {
    return;
  }
  
  const rangeInput = response.getResponseText().trim();
  const rangeMatch = rangeInput.match(/^(\d+)-(\d+)$/);
  
  if (!rangeMatch) {
    ui.alert('âŒ ì˜¬ë°”ë¥¸ ë²”ìœ„ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. ì˜ˆ: 1-100');
    return;
  }
  
  const startNum = parseInt(rangeMatch[1]);
  const endNum = parseInt(rangeMatch[2]);
  
  if (startNum >= endNum) {
    ui.alert('âŒ ì‹œì‘ ë²ˆí˜¸ê°€ ë ë²ˆí˜¸ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }
  
  // ë²”ìœ„ë¥¼ ì „ë‹¬í•˜ì—¬ ê²€ì¦ ì‹¤í–‰
  validateAllPricesWithRange(startNum, endNum);
}

// ========== ë²”ìœ„ ì§€ì • ê°€ëŠ¥í•œ ì „ì²´ ê°€ê²© ê²€ì¦ ==========
function validateAllPricesWithRange(startNum = null, endNum = null) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    const rangeText = startNum && endNum ? ` (${startNum}ë²ˆ ~ ${endNum}ë²ˆ)` : ' (ì „ì²´)';
    ui.alert(`ê°€ê²© ê²€ì¦ì„ ì‹œì‘í•©ë‹ˆë‹¤${rangeText}.\n\n14K/18K ë° 10K ì œí’ˆì„ ê²€ì¦í•©ë‹ˆë‹¤.`);
    
    // 14K/18K ê²€ì¦ ì‹¤í–‰
    validateOptionPricesWithRange(startNum, endNum);
    
    // 10K ê²€ì¦ ì‹¤í–‰
    validate10KPricesWithRange(startNum, endNum);
    
    // ê°€ê²© ë³€ë™ë¥  ê²€ì¦
    if (startNum && endNum) {
      validatePriceChangeRatioForRange(startNum, endNum);
    }
    
    ui.alert(`âœ… ê°€ê²© ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤${rangeText}!\n\n` +
            `ì˜µì…˜ê°€ê²©ê²€ì¦, 10Kê²€ì¦ê²°ê³¼, ê°€ê²©ë³€ë™ë¥ ê²€ì¦ ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
    
  } catch (error) {
    console.error('ì „ì²´ ê²€ì¦ ì˜¤ë¥˜:', error);
    ui.alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== ì „ì²´ ê°€ê²© ê²€ì¦ (ê¸°ì¡´ í•¨ìˆ˜) ==========
function validateAllPrices() {
  validateAllPricesWithRange(null, null);
}

// ========== ê°€ê²© ë³€ë™ë¥  ê²€ì¦ ==========
function validatePriceChangeRatio() {
  const ui = SpreadsheetApp.getUi();
  
  // ë²”ìœ„ ì…ë ¥ ë°›ê¸°
  const response = ui.prompt(
    'ë³€ë™ë¥  ê²€ì¦ ë²”ìœ„',
    'ê²€ì¦í•  ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n' +
    'ì˜ˆ: 1-100 (1ë²ˆë¶€í„° 100ë²ˆê¹Œì§€)\n' +
    'ì „ì²´ ê²€ì¦ì€ ì·¨ì†Œ í›„ ë©”ë‰´ì—ì„œ ì„ íƒí•˜ì„¸ìš”.',
    ui.ButtonSet.OK_CANCEL
  );
  
  if (response.getSelectedButton() === ui.Button.CANCEL) {
    // ì „ì²´ ê²€ì¦
    validatePriceChangeRatioForRange(null, null);
    return;
  }
  
  const rangeInput = response.getResponseText().trim();
  const rangeMatch = rangeInput.match(/^(\d+)-(\d+)$/);
  
  if (!rangeMatch) {
    ui.alert('âŒ ì˜¬ë°”ë¥¸ ë²”ìœ„ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. ì˜ˆ: 1-100');
    return;
  }
  
  const startNum = parseInt(rangeMatch[1]);
  const endNum = parseInt(rangeMatch[2]);
  
  validatePriceChangeRatioForRange(startNum, endNum);
}

// ========== ê°€ê²© ë³€ë™ë¥  ê²€ì¦ (ë²”ìœ„ ì§€ì •) ==========
function validatePriceChangeRatioForRange(startNum, endNum) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    // ë³€ë™ë¥  ê²€ì¦ ì‹œíŠ¸ ì¤€ë¹„
    let ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë³€ë™ë¥ ê²€ì¦ì‹œíŠ¸);
    if (!ê²€ì¦ì‹œíŠ¸) {
      ê²€ì¦ì‹œíŠ¸ = ss.insertSheet(CONFIG.ë³€ë™ë¥ ê²€ì¦ì‹œíŠ¸);
    } else {
      ê²€ì¦ì‹œíŠ¸.clear();
    }
    
    // í—¤ë” ì„¤ì •
    const headers = [
      'ë²ˆí˜¸', 'ì œí’ˆëª…', 'ì˜µì…˜', 'ì›ë³¸ê°€ê²©', 'ì‹ ê·œê°€ê²©', 'ë³€ë™ë¥ (%)', 
      'í‰ê· ë³€ë™ë¥ (%)', 'ì°¨ì´(%)', 'ê²€ì¦ê²°ê³¼', 'ë¹„ê³ '
    ];
    
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length).setValues([headers]);
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length)
      .setFontWeight('bold')
      .setBackground('#ff9800')
      .setFontColor('#ffffff');
    
    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const ì›ë³¸ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì›ë³¸ë°ì´í„°ì‹œíŠ¸);
    const ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    const ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    
    const ì›ë³¸ë°ì´í„° = ì›ë³¸ì‹œíŠ¸.getDataRange().getValues();
    const ê°€ê²©ë°ì´í„° = ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
    const ê°€ê²©ë§µ = parsePriceFile(ê°€ê²©ë°ì´í„°);
    
    const ê²€ì¦ê²°ê³¼ = [];
    const ì œí’ˆë³„ë³€ë™ë¥  = new Map();
    
    // 14K/18K ì œí’ˆ ê²€ì¦
    for (let i = 1; i < ì›ë³¸ë°ì´í„°.length; i++) {
      const row = ì›ë³¸ë°ì´í„°[i];
      const ë²ˆí˜¸ = i; // Aì—´ ë²ˆí˜¸
      const ì œí’ˆëª… = String(row[0] || '').trim();
      const íŒë§¤ê°€ê²© = parseFloat(String(row[27] || '0').replace(/,/g, ''));
      const ì˜µì…˜ëª…ë¬¸ìì—´ = String(row[4] || '');
      const ì˜µì…˜ê°€ê²©ë¬¸ìì—´ = String(row[5] || '');
      
      if (!ì œí’ˆëª… || !íŒë§¤ê°€ê²©) continue;
      
      // ë²”ìœ„ ì²´í¬
      if (startNum && endNum && (ë²ˆí˜¸ < startNum || ë²ˆí˜¸ > endNum)) continue;
      
      // ì›ë³¸ ì˜µì…˜ ê°€ê²© íŒŒì‹±
      const ì›ë³¸ì˜µì…˜ê°€ê²© = parseOriginalOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ì˜µì…˜ê°€ê²©ë¬¸ìì—´, íŒë§¤ê°€ê²©);
      
      // ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œ ë§¤ì¹­
      const ë§¤ì¹­ê²°ê³¼ = findMatchingProduct(ì œí’ˆëª…, ê°€ê²©ë§µ);
      const ì‹ ê·œê°€ê²©ì •ë³´ = ë§¤ì¹­ê²°ê³¼.ê°€ê²©ì •ë³´;
      
      if (!ì‹ ê·œê°€ê²©ì •ë³´) continue;
      
      // ê° ì˜µì…˜ë³„ ë³€ë™ë¥  ê³„ì‚°
      const ì˜µì…˜ëª©ë¡ = ['14Kì»¤í”Œ', '14Kë‚¨ì', '14Kì—¬ì', '18Kì»¤í”Œ', '18Kë‚¨ì', '18Kì—¬ì'];
      const ë³€ë™ë¥ ëª©ë¡ = [];
      
      for (const ì˜µì…˜ of ì˜µì…˜ëª©ë¡) {
        const ì›ë³¸ê°€ê²© = ì›ë³¸ì˜µì…˜ê°€ê²©[ì˜µì…˜] || 0;
        const ì‹ ê·œê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´[ì˜µì…˜] || 0;
        
        if (ì›ë³¸ê°€ê²© > 0 && ì‹ ê·œê°€ê²© > 0) {
          const ë³€ë™ë¥  = ((ì‹ ê·œê°€ê²© - ì›ë³¸ê°€ê²©) / ì›ë³¸ê°€ê²© * 100);
          ë³€ë™ë¥ ëª©ë¡.push(ë³€ë™ë¥ );
          
          if (!ì œí’ˆë³„ë³€ë™ë¥ .has(ì œí’ˆëª…)) {
            ì œí’ˆë³„ë³€ë™ë¥ .set(ì œí’ˆëª…, []);
          }
          ì œí’ˆë³„ë³€ë™ë¥ .get(ì œí’ˆëª…).push(ë³€ë™ë¥ );
        }
      }
      
      // í‰ê·  ë³€ë™ë¥  ê³„ì‚°
      if (ë³€ë™ë¥ ëª©ë¡.length > 0) {
        const í‰ê· ë³€ë™ë¥  = ë³€ë™ë¥ ëª©ë¡.reduce((a, b) => a + b, 0) / ë³€ë™ë¥ ëª©ë¡.length;
        
        // ê° ì˜µì…˜ë³„ë¡œ í‰ê· ê³¼ì˜ ì°¨ì´ ê²€ì¦
        for (let j = 0; j < ì˜µì…˜ëª©ë¡.length; j++) {
          const ì˜µì…˜ = ì˜µì…˜ëª©ë¡[j];
          const ì›ë³¸ê°€ê²© = ì›ë³¸ì˜µì…˜ê°€ê²©[ì˜µì…˜] || 0;
          const ì‹ ê·œê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´[ì˜µì…˜] || 0;
          
          if (ì›ë³¸ê°€ê²© > 0 && ì‹ ê·œê°€ê²© > 0) {
            const ë³€ë™ë¥  = ((ì‹ ê·œê°€ê²© - ì›ë³¸ê°€ê²©) / ì›ë³¸ê°€ê²© * 100);
            const ì°¨ì´ = Math.abs(ë³€ë™ë¥  - í‰ê· ë³€ë™ë¥ );
            
            let ê²€ì¦ê²°ê³¼ = 'ì •ìƒ';
            let ë¹„ê³  = '';
            
            // í‰ê·  ëŒ€ë¹„ 5% ì´ìƒ ì°¨ì´ë‚˜ë©´ ê²½ê³ 
            if (ì°¨ì´ > 5) {
              ê²€ì¦ê²°ê³¼ = 'âš ï¸ ì£¼ì˜';
              ë¹„ê³  = 'í‰ê·  ë³€ë™ë¥ ê³¼ 5% ì´ìƒ ì°¨ì´';
            }
            
            // í‰ê·  ëŒ€ë¹„ 10% ì´ìƒ ì°¨ì´ë‚˜ë©´ ìœ„í—˜
            if (ì°¨ì´ > 10) {
              ê²€ì¦ê²°ê³¼ = 'âŒ ìœ„í—˜';
              ë¹„ê³  = 'í‰ê·  ë³€ë™ë¥ ê³¼ 10% ì´ìƒ ì°¨ì´';
            }
            
            ê²€ì¦ê²°ê³¼.push([
              ë²ˆí˜¸,
              ì œí’ˆëª…,
              ì˜µì…˜,
              ì›ë³¸ê°€ê²©.toLocaleString(),
              ì‹ ê·œê°€ê²©.toLocaleString(),
              ë³€ë™ë¥ .toFixed(2),
              í‰ê· ë³€ë™ë¥ .toFixed(2),
              ì°¨ì´.toFixed(2),
              ê²€ì¦ê²°ê³¼,
              ë¹„ê³ 
            ]);
          }
        }
      }
    }
    
    // 10K ì œí’ˆë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
    if (ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸) {
      const ì‹­ì¼€ì´ë°ì´í„° = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸).getDataRange().getValues();
      const ì‹­ì¼€ì´ê°€ê²©ë°ì´í„° = ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
      const ì‹­ì¼€ì´ê°€ê²©ë§µ = parse10KPriceFile(ì‹­ì¼€ì´ê°€ê²©ë°ì´í„°);
      
      // 10K ê²€ì¦ ë¡œì§ ì¶”ê°€...
    }
    
    // ê²°ê³¼ ì¶œë ¥
    if (ê²€ì¦ê²°ê³¼.length > 0) {
      ê²€ì¦ì‹œíŠ¸.getRange(2, 1, ê²€ì¦ê²°ê³¼.length, headers.length).setValues(ê²€ì¦ê²°ê³¼);
      
      // ê²€ì¦ ê²°ê³¼ë³„ ìƒ‰ìƒ ì ìš©
      for (let i = 0; i < ê²€ì¦ê²°ê³¼.length; i++) {
        const ê²€ì¦ìƒíƒœ = ê²€ì¦ê²°ê³¼[i][8];
        const rowRange = ê²€ì¦ì‹œíŠ¸.getRange(i + 2, 1, 1, headers.length);
        
        if (ê²€ì¦ìƒíƒœ === 'ì •ìƒ') {
          rowRange.setBackground('#d4edda'); // ì´ˆë¡ìƒ‰
        } else if (ê²€ì¦ìƒíƒœ.includes('ì£¼ì˜')) {
          rowRange.setBackground('#fff3cd'); // ë…¸ë€ìƒ‰
        } else if (ê²€ì¦ìƒíƒœ.includes('ìœ„í—˜')) {
          rowRange.setBackground('#f8d7da'); // ë¹¨ê°„ìƒ‰
        }
      }
    }
    
    // ìš”ì•½ ì •ë³´
    const ìš”ì•½í–‰ = ê²€ì¦ì‹œíŠ¸.getLastRow() + 2;
    const ì •ìƒê±´ìˆ˜ = ê²€ì¦ê²°ê³¼.filter(r => r[8] === 'ì •ìƒ').length;
    const ì£¼ì˜ê±´ìˆ˜ = ê²€ì¦ê²°ê³¼.filter(r => r[8].includes('ì£¼ì˜')).length;
    const ìœ„í—˜ê±´ìˆ˜ = ê²€ì¦ê²°ê³¼.filter(r => r[8].includes('ìœ„í—˜')).length;
    
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰, 1).setValue('ğŸ“Š ë³€ë™ë¥  ê²€ì¦ ìš”ì•½').setFontWeight('bold');
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 1, 1).setValue(`âœ… ì •ìƒ: ${ì •ìƒê±´ìˆ˜}ê±´`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 2, 1).setValue(`âš ï¸ ì£¼ì˜: ${ì£¼ì˜ê±´ìˆ˜}ê±´ (í‰ê·  ëŒ€ë¹„ 5~10% ì°¨ì´)`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 3, 1).setValue(`âŒ ìœ„í—˜: ${ìœ„í—˜ê±´ìˆ˜}ê±´ (í‰ê·  ëŒ€ë¹„ 10% ì´ìƒ ì°¨ì´)`);
    
    const rangeText = startNum && endNum ? ` (${startNum}ë²ˆ ~ ${endNum}ë²ˆ)` : '';
    ui.alert(`âœ… ê°€ê²© ë³€ë™ë¥  ê²€ì¦ ì™„ë£Œ${rangeText}!\n\n` +
            `ì •ìƒ: ${ì •ìƒê±´ìˆ˜}ê±´\n` +
            `ì£¼ì˜: ${ì£¼ì˜ê±´ìˆ˜}ê±´\n` +
            `ìœ„í—˜: ${ìœ„í—˜ê±´ìˆ˜}ê±´`);
    
  } catch (error) {
    console.error('ë³€ë™ë¥  ê²€ì¦ ì˜¤ë¥˜:', error);
    ui.alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== 10K ê°€ê²© ê²€ì¦ (ë²”ìœ„ ì§€ì • ê°€ëŠ¥) ==========
function validate10KPricesWithRange(startNum, endNum) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    // ì‹œíŠ¸ ê°€ì ¸ì˜¤ê¸°
    const ì‹­ì¼€ì´ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸);
    const ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    
    if (!ì‹­ì¼€ì´ì‹œíŠ¸ || !ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸) {
      console.log('10K ì‹œíŠ¸ê°€ ì—†ì–´ ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      return;
    }
    
    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const ì‹­ì¼€ì´ë°ì´í„° = ì‹­ì¼€ì´ì‹œíŠ¸.getDataRange().getValues();
    const ì‹­ì¼€ì´ê°€ê²©ë°ì´í„° = ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
    
    // 10K ê²€ì¦ ê²°ê³¼ ì‹œíŠ¸ ì¤€ë¹„
    let ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName('10Kê²€ì¦ê²°ê³¼');
    if (!ê²€ì¦ì‹œíŠ¸) {
      ê²€ì¦ì‹œíŠ¸ = ss.insertSheet('10Kê²€ì¦ê²°ê³¼');
    } else {
      ê²€ì¦ì‹œíŠ¸.clear();
    }
    
    // ê²€ì¦ ì‹œíŠ¸ í—¤ë”
    const headers = [
      'ë²ˆí˜¸', 'ì œí’ˆëª…', 'ì˜µì…˜íƒ€ì…', 'ë§¤ì¹­ìƒíƒœ',
      'ì›ë³¸_10Kì»¤í”Œ', 'ê°€ê²©íŒŒì¼_10Kì»¤í”Œ', '10Kì»¤í”Œ_ê²€ì¦',
      'ì›ë³¸_10Kë‚¨ì', 'ê°€ê²©íŒŒì¼_10Kë‚¨ì', '10Kë‚¨ì_ê²€ì¦',
      'ì›ë³¸_10Kì—¬ì', 'ê°€ê²©íŒŒì¼_10Kì—¬ì', '10Kì—¬ì_ê²€ì¦',
      'ì „ì²´ê²€ì¦ê²°ê³¼', 'ë¹„ê³ '
    ];
    
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length).setValues([headers]);
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length)
      .setFontWeight('bold')
      .setBackground('#FFD700')  // ê¸ˆìƒ‰ (10K)
      .setFontColor('#000000');
    
    // 10K ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (ë²”ìœ„ í•„í„°ë§ ì¶”ê°€)
    const ì‹­ì¼€ì´ê°€ê²©ë§µ = parse10KPriceFileWithRange(ì‹­ì¼€ì´ê°€ê²©ë°ì´í„°, startNum, endNum);
    
    // 10K ë°ì´í„° ê²€ì¦
    const ê²€ì¦ê²°ê³¼ = [];
    let ì „ì²´ìƒí’ˆìˆ˜ = 0;
    let ì¼ì¹˜ìƒí’ˆìˆ˜ = 0;
    let ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜ = 0;
    let ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜ = 0;
    
    const í—ˆìš©ì˜¤ì°¨ = 10000;
    
    // ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ì œí’ˆëª… ëª©ë¡ ì¶”ì¶œ
    const ëŒ€ìƒì œí’ˆëª…ëª©ë¡ = new Set();
    for (let i = 1; i < ì‹­ì¼€ì´ê°€ê²©ë°ì´í„°.length; i += 3) {
      const í–‰ë²ˆí˜¸ = Math.floor((i - 1) / 3) + 1; // 3í–‰ì´ 1ê°œ ì œí’ˆì´ë¯€ë¡œ
      if (startNum && endNum && (í–‰ë²ˆí˜¸ < startNum || í–‰ë²ˆí˜¸ > endNum)) continue;
      
      const ì œí’ˆëª… = String(ì‹­ì¼€ì´ê°€ê²©ë°ì´í„°[i][5] || '').trim();
      if (ì œí’ˆëª…) {
        ëŒ€ìƒì œí’ˆëª…ëª©ë¡.add(ì œí’ˆëª…);
        // 10k ì œê±°í•œ ë²„ì „ë„ ì¶”ê°€
        if (ì œí’ˆëª….toLowerCase().startsWith('10k')) {
          ëŒ€ìƒì œí’ˆëª…ëª©ë¡.add(ì œí’ˆëª….substring(3).trim());
        }
      }
    }
    
    for (let i = 1; i < ì‹­ì¼€ì´ë°ì´í„°.length; i++) {
      const row = ì‹­ì¼€ì´ë°ì´í„°[i];
      const ì œí’ˆëª… = String(row[0] || '').trim(); // Aì—´
      
      // ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ì œí’ˆë§Œ ì²˜ë¦¬
      if (startNum && endNum) {
        let ë§¤ì¹­ë¨ = false;
        // ë‹¤ì–‘í•œ í˜•íƒœë¡œ ë§¤ì¹­ í™•ì¸
        if (ëŒ€ìƒì œí’ˆëª…ëª©ë¡.has(ì œí’ˆëª…)) {
          ë§¤ì¹­ë¨ = true;
        } else if (ì œí’ˆëª….toLowerCase().startsWith('10k')) {
          const ì œí’ˆëª…_10kì œê±° = ì œí’ˆëª….substring(3).trim();
          if (ëŒ€ìƒì œí’ˆëª…ëª©ë¡.has(ì œí’ˆëª…_10kì œê±°)) {
            ë§¤ì¹­ë¨ = true;
          }
        }
        
        if (!ë§¤ì¹­ë¨) continue;
      }
      
      const ì˜µì…˜ëª…ë¬¸ìì—´ = String(row[44] || ''); // ASì—´ (10K ì˜µì…˜ëª…)
      const ê°€ê²©ì°¨ì´ë¬¸ìì—´ = String(row[45] || ''); // ATì—´ (10K ì°¨ì´ê°’)
      const íŒë§¤ê°€ê²© = parseFloat(String(row[27] || '0').replace(/,/g, '')); // ABì—´
      
      if (!ì œí’ˆëª…) continue;
      
      ì „ì²´ìƒí’ˆìˆ˜++;
      
      // ì˜µì…˜ íƒ€ì… ê²°ì •
      const ì•ˆìª½ë§‰ìŒí¬í•¨ = ì˜µì…˜ëª…ë¬¸ìì—´.includes('[ì•ˆìª½ë§‰ìŒ]');
      const ì˜µì…˜íƒ€ì… = ì•ˆìª½ë§‰ìŒí¬í•¨ ? 'ì•ˆìª½ë§‰ìŒí¬í•¨' : 'ì¼ë°˜';
      
      // 10K ì˜µì…˜ ê°€ê²© íŒŒì‹±
      const ì›ë³¸ì˜µì…˜ê°€ê²© = parse10KOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ê°€ê²©ì°¨ì´ë¬¸ìì—´, íŒë§¤ê°€ê²©);
      
      // ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œ ë§¤ì¹­
      let ê°€ê²©íŒŒì¼ì •ë³´ = ì‹­ì¼€ì´ê°€ê²©ë§µ.get(ì œí’ˆëª…);
      
      // ë‹¤ì–‘í•œ í˜•íƒœë¡œ ë§¤ì¹­ ì‹œë„
      if (!ê°€ê²©íŒŒì¼ì •ë³´) {
        if (ì œí’ˆëª….toLowerCase().startsWith('10k ')) {
          const ì œí’ˆëª…_10kì œê±° = ì œí’ˆëª….substring(4).trim();
          ê°€ê²©íŒŒì¼ì •ë³´ = ì‹­ì¼€ì´ê°€ê²©ë§µ.get(ì œí’ˆëª…_10kì œê±°);
        } else if (ì œí’ˆëª….toLowerCase().startsWith('10k')) {
          const ì œí’ˆëª…_10kì œê±° = ì œí’ˆëª….substring(3).trim();
          ê°€ê²©íŒŒì¼ì •ë³´ = ì‹­ì¼€ì´ê°€ê²©ë§µ.get(ì œí’ˆëª…_10kì œê±°);
        }
      }
      
      // ë²ˆí˜¸ ì°¾ê¸°
      let ë²ˆí˜¸ = 0;
      for (const [key, value] of ì‹­ì¼€ì´ê°€ê²©ë§µ) {
        if (value === ê°€ê²©íŒŒì¼ì •ë³´) {
          ë²ˆí˜¸ = value._rowNumber || 0;
          break;
        }
      }
      
      if (!ê°€ê²©íŒŒì¼ì •ë³´) {
        ê²€ì¦ê²°ê³¼.push([
          ë²ˆí˜¸ || '?',
          ì œí’ˆëª…, ì˜µì…˜íƒ€ì…, 'âŒ ë¯¸ë§¤ì¹­',
          ì›ë³¸ì˜µì…˜ê°€ê²©['10Kì»¤í”Œ'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['10Kë‚¨ì'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['10Kì—¬ì'] || '', '', 'âŒ',
          'âŒ ë¯¸ë§¤ì¹­', '10Kê°€ê²©ìˆ˜ì •íŒŒì¼ì— ì—†ìŒ'
        ]);
        ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜++;
        continue;
      }
      
      // ê° ì˜µì…˜ë³„ ê²€ì¦
      let ëª¨ë‘ì¼ì¹˜ = true;
      const ê²€ì¦í–‰ = [ë²ˆí˜¸, ì œí’ˆëª…, ì˜µì…˜íƒ€ì…, ''];
      let ê²€ì¦ìƒì„¸ = [];
      
      const ì˜µì…˜ìˆœì„œ = ['10Kì»¤í”Œ', '10Kë‚¨ì', '10Kì—¬ì'];
      
      for (const ì˜µì…˜ of ì˜µì…˜ìˆœì„œ) {
        const ì›ë³¸ê°€ê²© = ì›ë³¸ì˜µì…˜ê°€ê²©[ì˜µì…˜] || 0;
        const ê°€ê²©íŒŒì¼ê°€ê²© = ê°€ê²©íŒŒì¼ì •ë³´[ì˜µì…˜] || 0;
        const ì°¨ì´ = Math.abs(ì›ë³¸ê°€ê²© - ê°€ê²©íŒŒì¼ê°€ê²©);
        const ì¼ì¹˜ = ì°¨ì´ <= í—ˆìš©ì˜¤ì°¨;
        
        let ê²€ì¦ë©”ì‹œì§€ = '';
        if (ì°¨ì´ === 0) {
          ê²€ì¦ë©”ì‹œì§€ = 'âœ…';
        } else if (ì¼ì¹˜) {
          ê²€ì¦ë©”ì‹œì§€ = `âœ… (ì°¨ì´: ${ì°¨ì´.toLocaleString()}ì›)`;
        } else {
          ê²€ì¦ë©”ì‹œì§€ = `âŒ (ì°¨ì´: ${ì°¨ì´.toLocaleString()}ì›)`;
          ëª¨ë‘ì¼ì¹˜ = false;
          ê²€ì¦ìƒì„¸.push(`${ì˜µì…˜}: ${ì°¨ì´.toLocaleString()}ì› ì°¨ì´`);
        }
        
        ê²€ì¦í–‰.push(ì›ë³¸ê°€ê²©);
        ê²€ì¦í–‰.push(ê°€ê²©íŒŒì¼ê°€ê²©);
        ê²€ì¦í–‰.push(ê²€ì¦ë©”ì‹œì§€);
      }
      
      ê²€ì¦í–‰[3] = ëª¨ë‘ì¼ì¹˜ ? 'âœ… ì¼ì¹˜' : 'âš ï¸ ë¶ˆì¼ì¹˜';
      ê²€ì¦í–‰.push(ëª¨ë‘ì¼ì¹˜ ? 'âœ… ì „ì²´ì¼ì¹˜' : 'âŒ ë¶ˆì¼ì¹˜');
      ê²€ì¦í–‰.push(ê²€ì¦ìƒì„¸.join(', ') || '');
      
      ê²€ì¦ê²°ê³¼.push(ê²€ì¦í–‰);
      
      if (ëª¨ë‘ì¼ì¹˜) {
        ì¼ì¹˜ìƒí’ˆìˆ˜++;
      } else {
        ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜++;
      }
    }
    
    // ê²°ê³¼ ì¶œë ¥
    if (ê²€ì¦ê²°ê³¼.length > 0) {
      ê²€ì¦ì‹œíŠ¸.getRange(2, 1, ê²€ì¦ê²°ê³¼.length, headers.length).setValues(ê²€ì¦ê²°ê³¼);
      
      // ìƒíƒœë³„ ìƒ‰ìƒ ì ìš©
      for (let i = 0; i < ê²€ì¦ê²°ê³¼.length; i++) {
        const ìƒíƒœ = ê²€ì¦ê²°ê³¼[i][3];
        const rowRange = ê²€ì¦ì‹œíŠ¸.getRange(i + 2, 1, 1, headers.length);
        
        if (ìƒíƒœ === 'âœ… ì¼ì¹˜') {
          rowRange.setBackground('#d4edda'); // ì´ˆë¡ìƒ‰
        } else if (ìƒíƒœ === 'âš ï¸ ë¶ˆì¼ì¹˜') {
          rowRange.setBackground('#fff3cd'); // ë…¸ë€ìƒ‰
        } else if (ìƒíƒœ === 'âŒ ë¯¸ë§¤ì¹­') {
          rowRange.setBackground('#f8d7da'); // ë¹¨ê°„ìƒ‰
        }
      }
    }
    
    // ìš”ì•½ ì •ë³´
    const ìš”ì•½í–‰ = ê²€ì¦ì‹œíŠ¸.getLastRow() + 2;
    const rangeText = startNum && endNum ? ` (${startNum}ë²ˆ ~ ${endNum}ë²ˆ)` : '';
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰, 1).setValue(`ğŸ“Š 10K ê²€ì¦ ìš”ì•½${rangeText}`).setFontWeight('bold');
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 1, 1).setValue(`âœ… ì „ì²´ ìƒí’ˆ: ${ì „ì²´ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 2, 1).setValue(`âœ… ì¼ì¹˜: ${ì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 3, 1).setValue(`âš ï¸ ë¶ˆì¼ì¹˜: ${ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 4, 1).setValue(`âŒ ë¯¸ë§¤ì¹­: ${ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜}ê°œ`);
    
  } catch (error) {
    console.error('10K ê²€ì¦ ì˜¤ë¥˜:', error);
    ui.alert('âŒ 10K ê²€ì¦ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== 10K ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (ë²”ìœ„ ì§€ì •) ==========
function parse10KPriceFileWithRange(ê°€ê²©ë°ì´í„°, startNum, endNum) {
  const ê°€ê²©ë§µ = new Map();
  
  // 3í–‰ì”© ì²˜ë¦¬ (ë‚¨ìë‹¨í’ˆ, ì—¬ìë‹¨í’ˆ, ì»¤í”Œ ìˆœì„œ)
  for (let i = 1; i < ê°€ê²©ë°ì´í„°.length; i += 3) {
    const í–‰ë²ˆí˜¸ = Math.floor((i - 1) / 3) + 1; // 3í–‰ì´ 1ê°œ ì œí’ˆì´ë¯€ë¡œ
    
    // ë²”ìœ„ ì²´í¬
    if (startNum && endNum && (í–‰ë²ˆí˜¸ < startNum || í–‰ë²ˆí˜¸ > endNum)) continue;
    
    const ì œí’ˆëª…ì›ë³¸ = String(ê°€ê²©ë°ì´í„°[i][5] || '').trim(); // Fì—´
    
    if (!ì œí’ˆëª…ì›ë³¸) continue;
    
    const ë‚¨ìí–‰ = i;
    const ì—¬ìí–‰ = i + 1;
    const ì»¤í”Œí–‰ = i + 2;
    
    if (ì—¬ìí–‰ >= ê°€ê²©ë°ì´í„°.length || ì»¤í”Œí–‰ >= ê°€ê²©ë°ì´í„°.length) continue;
    
    const ê°€ê²©ì •ë³´ = {
      // ì¼ë°˜ 10K ê°€ê²© (Oì—´: 30% í• ì¸ëœ ì‹¤ì œê°€ê²©)
      '10Kë‚¨ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ë‚¨ìí–‰][14] || '0').replace(/,/g, '')) || 0,
      '10Kì—¬ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ì—¬ìí–‰][14] || '0').replace(/,/g, '')) || 0,
      '10Kì»¤í”Œ': parseFloat(String(ê°€ê²©ë°ì´í„°[ì»¤í”Œí–‰][14] || '0').replace(/,/g, '')) || 0,
      '_rowNumber': í–‰ë²ˆí˜¸ // ë²ˆí˜¸ ì €ì¥
    };
    
    // ì•ˆìª½ë§‰ìŒ ê°€ê²©ì´ ìˆëŠ” ê²½ìš° (ACì—´)
    const ì•ˆìª½ë§‰ìŒë‚¨ì = parseFloat(String(ê°€ê²©ë°ì´í„°[ë‚¨ìí–‰][28] || '0').replace(/,/g, ''));
    const ì•ˆìª½ë§‰ìŒì—¬ì = parseFloat(String(ê°€ê²©ë°ì´í„°[ì—¬ìí–‰][28] || '0').replace(/,/g, ''));
    const ì•ˆìª½ë§‰ìŒì»¤í”Œ = parseFloat(String(ê°€ê²©ë°ì´í„°[ì»¤í”Œí–‰][28] || '0').replace(/,/g, ''));
    
    if (ì•ˆìª½ë§‰ìŒì»¤í”Œ > 0) {
      ê°€ê²©ì •ë³´['10Kë‚¨ì_ì•ˆìª½ë§‰ìŒ'] = ì•ˆìª½ë§‰ìŒë‚¨ì;
      ê°€ê²©ì •ë³´['10Kì—¬ì_ì•ˆìª½ë§‰ìŒ'] = ì•ˆìª½ë§‰ìŒì—¬ì;
      ê°€ê²©ì •ë³´['10Kì»¤í”Œ_ì•ˆìª½ë§‰ìŒ'] = ì•ˆìª½ë§‰ìŒì»¤í”Œ;
    }
    
    // ì œí’ˆëª…ì„ ì—¬ëŸ¬ í˜•íƒœë¡œ ì €ì¥
    ê°€ê²©ë§µ.set(ì œí’ˆëª…ì›ë³¸, ê°€ê²©ì •ë³´);
    
    // "10k" ì œê±°í•œ ë²„ì „ë„ ì €ì¥
    if (ì œí’ˆëª…ì›ë³¸.toLowerCase().startsWith('10k')) {
      const ì œí’ˆëª…_10kì œê±° = ì œí’ˆëª…ì›ë³¸.substring(3).trim();
      ê°€ê²©ë§µ.set(ì œí’ˆëª…_10kì œê±°, ê°€ê²©ì •ë³´);
    }
    
    // "10k" ì¶”ê°€í•œ ë²„ì „ë„ ì €ì¥
    if (!ì œí’ˆëª…ì›ë³¸.toLowerCase().startsWith('10k')) {
      ê°€ê²©ë§µ.set('10k' + ì œí’ˆëª…ì›ë³¸, ê°€ê²©ì •ë³´);
    }
  }
  
  return ê°€ê²©ë§µ;
}

// ========== 10K ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (ê¸°ì¡´) ==========
function parse10KPriceFile(ê°€ê²©ë°ì´í„°) {
  return parse10KPriceFileWithRange(ê°€ê²©ë°ì´í„°, null, null);
}

// ========== 10K ì˜µì…˜ ê°€ê²© íŒŒì‹± ==========
function parse10KOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ê°€ê²©ì°¨ì´ë¬¸ìì—´, íŒë§¤ê°€ê²©) {
  const ì˜µì…˜ê°€ê²© = {};
  
  // Eì—´ê³¼ Fì—´ íŒŒì‹±
  const ì˜µì…˜ëª…ë“¤ = ì˜µì…˜ëª…ë¬¸ìì—´.split(',').map(s => s.trim());
  const ê°€ê²©ì°¨ì´ë“¤ = ê°€ê²©ì°¨ì´ë¬¸ìì—´.split(',').map(s => {
    const num = parseFloat(s.replace(/,/g, '').trim());
    return isNaN(num) ? 0 : num;
  });
  
  // íŒë§¤ê°€ê²©(ABì—´)ì€ ì •ê°€!! 30% í• ì¸ì„ ì ìš©í•´ì•¼ í•¨
  for (let i = 0; i < ì˜µì…˜ëª…ë“¤.length && i < ê°€ê²©ì°¨ì´ë“¤.length; i++) {
    const ì˜µì…˜ëª… = ì˜µì…˜ëª…ë“¤[i];
    const ì°¨ì´ê°’ = ê°€ê²©ì°¨ì´ë“¤[i];
    
    // 1. íŒë§¤ê°€ê²©(ì •ê°€) + Fì—´ ì°¨ì´ê°’ = ê° ì˜µì…˜ì˜ ì •ìƒê°€
    const ì •ìƒê°€ = íŒë§¤ê°€ê²© + ì°¨ì´ê°’;
    // 2. ì •ìƒê°€ Ã— 0.7 = ì‹¤ì œ íŒë§¤ê°€ (30% í• ì¸)
    const ì‹¤ì œíŒë§¤ê°€ = ì •ìƒê°€ * 0.7;
    // 3. ì²œì›ë‹¨ìœ„ ì˜¬ë¦¼
    const ìµœì¢…ê°€ê²© = Math.ceil(ì‹¤ì œíŒë§¤ê°€ / 1000) * 1000;
    
    if (ì˜µì…˜ëª….includes('ì»¤í”Œë§') && !ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kì»¤í”Œ'] = ìµœì¢…ê°€ê²©;
    } else if (ì˜µì…˜ëª….includes('ë‚¨ìë‹¨í’ˆ') && !ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kë‚¨ì'] = ìµœì¢…ê°€ê²©;
    } else if (ì˜µì…˜ëª….includes('ì—¬ìë‹¨í’ˆ') && !ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kì—¬ì'] = ìµœì¢…ê°€ê²©;
    } else if (ì˜µì…˜ëª….includes('ì»¤í”Œë§') && ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kì»¤í”Œ_ì•ˆìª½ë§‰ìŒ'] = ìµœì¢…ê°€ê²©;
    } else if (ì˜µì…˜ëª….includes('ë‚¨ìë‹¨í’ˆ') && ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kë‚¨ì_ì•ˆìª½ë§‰ìŒ'] = ìµœì¢…ê°€ê²©;
    } else if (ì˜µì…˜ëª….includes('ì—¬ìë‹¨í’ˆ') && ì˜µì…˜ëª….includes('ì•ˆìª½ë§‰ìŒ')) {
      ì˜µì…˜ê°€ê²©['10Kì—¬ì_ì•ˆìª½ë§‰ìŒ'] = ìµœì¢…ê°€ê²©;
    }
  }
  
  return ì˜µì…˜ê°€ê²©;
}

// ========== ì˜µì…˜ ê°€ê²© ê²€ì¦ (14K/18K - ë²”ìœ„ ì§€ì • ê°€ëŠ¥) ==========
function validateOptionPricesWithRange(startNum, endNum) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    // ì‹œíŠ¸ ê°€ì ¸ì˜¤ê¸°
    const ì›ë³¸ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì›ë³¸ë°ì´í„°ì‹œíŠ¸);
    const ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    
    if (!ì›ë³¸ì‹œíŠ¸ || !ê°€ê²©ì‹œíŠ¸) {
      ui.alert('âŒ ì›ë³¸ë°ì´í„° ë˜ëŠ” ê°€ê²©ìˆ˜ì •íŒŒì¼ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }
    
    // 10K ì œí’ˆëª… ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    const ì‹­ì¼€ì´ì œí’ˆëª…ëª©ë¡ = new Set();
    const ì‹­ì¼€ì´ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸);
    if (ì‹­ì¼€ì´ì‹œíŠ¸) {
      const ì‹­ì¼€ì´ë°ì´í„° = ì‹­ì¼€ì´ì‹œíŠ¸.getDataRange().getValues();
      for (let i = 1; i < ì‹­ì¼€ì´ë°ì´í„°.length; i++) {
        const ì œí’ˆëª… = String(ì‹­ì¼€ì´ë°ì´í„°[i][0] || '').trim();
        if (ì œí’ˆëª…) {
          ì‹­ì¼€ì´ì œí’ˆëª…ëª©ë¡.add(ì œí’ˆëª…);
          if (ì œí’ˆëª….toLowerCase().startsWith('10k')) {
            ì‹­ì¼€ì´ì œí’ˆëª…ëª©ë¡.add(ì œí’ˆëª….substring(3).trim());
          }
        }
      }
    }
    
    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const ì›ë³¸ë°ì´í„° = ì›ë³¸ì‹œíŠ¸.getDataRange().getValues();
    const ê°€ê²©ë°ì´í„° = ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
    
    // ê²€ì¦ ê²°ê³¼ ì‹œíŠ¸ ì¤€ë¹„
    let ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì˜µì…˜ê²€ì¦ì‹œíŠ¸);
    if (!ê²€ì¦ì‹œíŠ¸) {
      ê²€ì¦ì‹œíŠ¸ = ss.insertSheet(CONFIG.ì˜µì…˜ê²€ì¦ì‹œíŠ¸);
    } else {
      ê²€ì¦ì‹œíŠ¸.clear();
    }
    
    // ë¯¸ë§¤ì¹­ ì›ë³¸ìƒí’ˆ ì‹œíŠ¸ ì¤€ë¹„
    let ë¯¸ë§¤ì¹­ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë¯¸ë§¤ì¹­ì›ë³¸ì‹œíŠ¸);
    if (!ë¯¸ë§¤ì¹­ì‹œíŠ¸) {
      ë¯¸ë§¤ì¹­ì‹œíŠ¸ = ss.insertSheet(CONFIG.ë¯¸ë§¤ì¹­ì›ë³¸ì‹œíŠ¸);
    } else {
      ë¯¸ë§¤ì¹­ì‹œíŠ¸.clear();
    }
    
    // ê²€ì¦ ì‹œíŠ¸ í—¤ë”
    const headers = [
      'ë²ˆí˜¸', 'ì œí’ˆëª…', 'ë§¤ì¹­ìƒíƒœ', 'í• ì¸ìœ¨',
      'ì›ë³¸_14Kì»¤í”Œ', 'ê°€ê²©íŒŒì¼_14Kì»¤í”Œ', '14Kì»¤í”Œ_ê²€ì¦',
      'ì›ë³¸_14Kë‚¨ì', 'ê°€ê²©íŒŒì¼_14Kë‚¨ì', '14Kë‚¨ì_ê²€ì¦',
      'ì›ë³¸_14Kì—¬ì', 'ê°€ê²©íŒŒì¼_14Kì—¬ì', '14Kì—¬ì_ê²€ì¦',
      'ì›ë³¸_18Kì»¤í”Œ', 'ê°€ê²©íŒŒì¼_18Kì»¤í”Œ', '18Kì»¤í”Œ_ê²€ì¦',
      'ì›ë³¸_18Kë‚¨ì', 'ê°€ê²©íŒŒì¼_18Kë‚¨ì', '18Kë‚¨ì_ê²€ì¦',
      'ì›ë³¸_18Kì—¬ì', 'ê°€ê²©íŒŒì¼_18Kì—¬ì', '18Kì—¬ì_ê²€ì¦',
      'ì „ì²´ê²€ì¦ê²°ê³¼', 'ë¹„ê³ '
    ];
    
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length).setValues([headers]);
    ê²€ì¦ì‹œíŠ¸.getRange(1, 1, 1, headers.length)
      .setFontWeight('bold')
      .setBackground('#4285f4')
      .setFontColor('#ffffff');
    
    // ë¯¸ë§¤ì¹­ ì‹œíŠ¸ í—¤ë”
    const ë¯¸ë§¤ì¹­í—¤ë” = [
      'ë²ˆí˜¸', 'ìƒí’ˆì½”ë“œ', 'ì œí’ˆëª…', 'íŒë§¤ê°€ê²©', 'ì˜µì…˜ëª…', 'ì˜µì…˜ê°€ê²©ì°¨ì´', 
      '14Kì»¤í”Œê°€ê²©', '14Kë‚¨ìê°€ê²©', '14Kì—¬ìê°€ê²©',
      '18Kì»¤í”Œê°€ê²©', '18Kë‚¨ìê°€ê²©', '18Kì—¬ìê°€ê²©',
      'ìœ ì‚¬ì œí’ˆíŒíŠ¸'
    ];
    
    ë¯¸ë§¤ì¹­ì‹œíŠ¸.getRange(1, 1, 1, ë¯¸ë§¤ì¹­í—¤ë”.length).setValues([ë¯¸ë§¤ì¹­í—¤ë”]);
    ë¯¸ë§¤ì¹­ì‹œíŠ¸.getRange(1, 1, 1, ë¯¸ë§¤ì¹­í—¤ë”.length)
      .setFontWeight('bold')
      .setBackground('#ff6b6b')
      .setFontColor('#ffffff');
    
    // ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (ë²”ìœ„ í•„í„°ë§ ì¶”ê°€)
    const ê°€ê²©ë§µ = parsePriceFileWithRange(ê°€ê²©ë°ì´í„°, startNum, endNum);
    
    // ì›ë³¸ë°ì´í„° íŒŒì‹± ë° ê²€ì¦
    const ê²€ì¦ê²°ê³¼ = [];
    const ë¯¸ë§¤ì¹­ì›ë³¸ = [];
    let ì „ì²´ìƒí’ˆìˆ˜ = 0;
    let ì¼ì¹˜ìƒí’ˆìˆ˜ = 0;
    let ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜ = 0;
    let ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜ = 0;
    let í• ì¸ìœ¨10_ìƒí’ˆìˆ˜ = 0;
    let í• ì¸ìœ¨30_ìƒí’ˆìˆ˜ = 0;
    let í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜ = 0;
    
    const í—ˆìš©ì˜¤ì°¨ = 10000;
    
    // ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ì œí’ˆëª… ëª©ë¡ ì¶”ì¶œ
    const ëŒ€ìƒì œí’ˆëª…ëª©ë¡ = new Set();
    for (let i = 1; i < ê°€ê²©ë°ì´í„°.length; i += 3) {
      const í–‰ë²ˆí˜¸ = Math.floor((i - 1) / 3) + 1;
      if (startNum && endNum && (í–‰ë²ˆí˜¸ < startNum || í–‰ë²ˆí˜¸ > endNum)) continue;
      
      const ì œí’ˆëª… = String(ê°€ê²©ë°ì´í„°[i][5] || '').trim();
      if (ì œí’ˆëª…) {
        ëŒ€ìƒì œí’ˆëª…ëª©ë¡.add(ì œí’ˆëª…);
      }
    }
    
    for (let i = 1; i < ì›ë³¸ë°ì´í„°.length; i++) {
      const row = ì›ë³¸ë°ì´í„°[i];
      const ìƒí’ˆì½”ë“œ = String(row[1] || '').trim(); // Bì—´
      const ì œí’ˆëª… = String(row[0] || '').trim(); // Aì—´
      const íŒë§¤ê°€ê²© = parseFloat(String(row[27] || '0').replace(/,/g, '')); // ABì—´
      const ì˜µì…˜ëª…ë¬¸ìì—´ = String(row[4] || ''); // Eì—´
      const ì˜µì…˜ê°€ê²©ë¬¸ìì—´ = String(row[5] || ''); // Fì—´
      
      if (!ì œí’ˆëª… || !íŒë§¤ê°€ê²©) continue;
      
      // 10K ì œí’ˆì€ ì œì™¸
      if (ì‹­ì¼€ì´ì œí’ˆëª…ëª©ë¡.has(ì œí’ˆëª…)) {
        console.log(`10K ì œí’ˆ ì œì™¸: ${ì œí’ˆëª…}`);
        continue;
      }
      
      // ì›ë³¸ ì˜µì…˜ ê°€ê²© íŒŒì‹±
      const ì›ë³¸ì˜µì…˜ê°€ê²© = parseOriginalOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ì˜µì…˜ê°€ê²©ë¬¸ìì—´, íŒë§¤ê°€ê²©);
      
      // ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œ ë§¤ì¹­ë˜ëŠ” ì œí’ˆ ì°¾ê¸°
      const ë§¤ì¹­ê²°ê³¼ = findMatchingProduct(ì œí’ˆëª…, ê°€ê²©ë§µ);
      const ê°€ê²©íŒŒì¼ì •ë³´ = ë§¤ì¹­ê²°ê³¼.ê°€ê²©ì •ë³´;
      const ë§¤ì¹­ëœí‚¤ = ë§¤ì¹­ê²°ê³¼.ë§¤ì¹­í‚¤;
      
      // ë²ˆí˜¸ ì°¾ê¸°
      const ë²ˆí˜¸ = ê°€ê²©íŒŒì¼ì •ë³´ ? (ê°€ê²©íŒŒì¼ì •ë³´._rowNumber || 0) : 0;
      
      // ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ì œí’ˆë§Œ ì²˜ë¦¬
      if (startNum && endNum) {
        if (!ê°€ê²©íŒŒì¼ì •ë³´) {
          // ë¯¸ë§¤ì¹­ì´ë©´ ê±´ë„ˆë›°ê¸°
          continue;
        }
        // ëŒ€ìƒ ì œí’ˆì´ ì•„ë‹ˆë©´ ê±´ë„ˆë›°ê¸°
        if (!ëŒ€ìƒì œí’ˆëª…ëª©ë¡.has(ë§¤ì¹­ëœí‚¤)) {
          continue;
        }
      }
      
      ì „ì²´ìƒí’ˆìˆ˜++;
      
      if (!ê°€ê²©íŒŒì¼ì •ë³´) {
        // ë§¤ì¹­ë˜ëŠ” ì œí’ˆì´ ì—†ìŒ
        const ìœ ì‚¬ì œí’ˆë“¤ = [];
        const ì œí’ˆëª…ì²«ê¸€ì = ì œí’ˆëª….substring(0, 2);
        
        for (const key of ê°€ê²©ë§µ.keys()) {
          if (key.includes(ì œí’ˆëª…ì²«ê¸€ì)) {
            ìœ ì‚¬ì œí’ˆë“¤.push(key);
            if (ìœ ì‚¬ì œí’ˆë“¤.length >= 3) break;
          }
        }
        
        const ìœ ì‚¬ì œí’ˆíŒíŠ¸ = ìœ ì‚¬ì œí’ˆë“¤.length > 0 
          ? `ìœ ì‚¬: ${ìœ ì‚¬ì œí’ˆë“¤.join(', ')}` 
          : 'ê°€ê²©ìˆ˜ì •íŒŒì¼ì— ìœ ì‚¬í•œ ì œí’ˆ ì—†ìŒ';
        
        ë¯¸ë§¤ì¹­ì›ë³¸.push([
          ë²ˆí˜¸ || '?',
          ìƒí’ˆì½”ë“œ,
          ì œí’ˆëª…,
          íŒë§¤ê°€ê²©,
          ì˜µì…˜ëª…ë¬¸ìì—´,
          ì˜µì…˜ê°€ê²©ë¬¸ìì—´,
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kì»¤í”Œ'] || '',
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kë‚¨ì'] || '',
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kì—¬ì'] || '',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kì»¤í”Œ'] || '',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kë‚¨ì'] || '',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kì—¬ì'] || '',
          ìœ ì‚¬ì œí’ˆíŒíŠ¸
        ]);
        
        ê²€ì¦ê²°ê³¼.push([
          ë²ˆí˜¸ || '?',
          ì œí’ˆëª…, 'âŒ ë¯¸ë§¤ì¹­', '', // í• ì¸ìœ¨ ì—´
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kì»¤í”Œ'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kë‚¨ì'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['14Kì—¬ì'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kì»¤í”Œ'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kë‚¨ì'] || '', '', 'âŒ',
          ì›ë³¸ì˜µì…˜ê°€ê²©['18Kì—¬ì'] || '', '', 'âŒ',
          'âŒ ë¯¸ë§¤ì¹­', ìœ ì‚¬ì œí’ˆíŒíŠ¸
        ]);
        ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜++;
        continue;
      }
      
      // ê° ì˜µì…˜ë³„ ê²€ì¦
      let ëª¨ë‘ì¼ì¹˜ = true;
      const ê²€ì¦í–‰ = [ë²ˆí˜¸, ì œí’ˆëª…, '', '']; // ë²ˆí˜¸, í• ì¸ìœ¨ ì—´ ì¶”ê°€
      let ê²€ì¦ìƒì„¸ = [];
      let ìƒí’ˆí• ì¸ìœ¨ = null;
      
      const ì˜µì…˜ìˆœì„œ = ['14Kì»¤í”Œ', '14Kë‚¨ì', '14Kì—¬ì', '18Kì»¤í”Œ', '18Kë‚¨ì', '18Kì—¬ì'];
      
      for (const ì˜µì…˜ of ì˜µì…˜ìˆœì„œ) {
        const ì›ë³¸ê°€ê²©_30 = ì›ë³¸ì˜µì…˜ê°€ê²©[ì˜µì…˜] || 0;
        const ì›ë³¸ê°€ê²©_10 = ì›ë³¸ì˜µì…˜ê°€ê²©[ì˜µì…˜ + '_10%'] || 0;
        const ê°€ê²©íŒŒì¼ê°€ê²© = ê°€ê²©íŒŒì¼ì •ë³´[ì˜µì…˜] || 0;
        
        // 30% í• ì¸ê³¼ 10% í• ì¸ ì¤‘ ì–´ëŠ ê²ƒì´ ë” ê°€ê¹Œìš´ì§€ í™•ì¸
        const ì°¨ì´_30 = Math.abs(ì›ë³¸ê°€ê²©_30 - ê°€ê²©íŒŒì¼ê°€ê²©);
        const ì°¨ì´_10 = Math.abs(ì›ë³¸ê°€ê²©_10 - ê°€ê²©íŒŒì¼ê°€ê²©);
        
        let ì›ë³¸ê°€ê²©, ì°¨ì´, í• ì¸ìœ¨;
        
        if (ì°¨ì´_30 <= ì°¨ì´_10) {
          ì›ë³¸ê°€ê²© = ì›ë³¸ê°€ê²©_30;
          ì°¨ì´ = ì°¨ì´_30;
          í• ì¸ìœ¨ = '30%';
        } else {
          ì›ë³¸ê°€ê²© = ì›ë³¸ê°€ê²©_10;
          ì°¨ì´ = ì°¨ì´_10;
          í• ì¸ìœ¨ = '10%';
        }
        
        // ì²« ë²ˆì§¸ ì˜µì…˜(14Kì»¤í”Œ)ì˜ í• ì¸ìœ¨ì„ ìƒí’ˆ ëŒ€í‘œ í• ì¸ìœ¨ë¡œ ì„¤ì •
        if (ì˜µì…˜ === '14Kì»¤í”Œ' && ì°¨ì´ <= í—ˆìš©ì˜¤ì°¨) {
          ìƒí’ˆí• ì¸ìœ¨ = í• ì¸ìœ¨;
        }
        
        const ì¼ì¹˜ = ì°¨ì´ <= í—ˆìš©ì˜¤ì°¨;
        
        let ê²€ì¦ìƒíƒœ = '';
        let ê²€ì¦ë©”ì‹œì§€ = '';
        
        if (ì°¨ì´ === 0) {
          ê²€ì¦ìƒíƒœ = 'ì¼ì¹˜';
          ê²€ì¦ë©”ì‹œì§€ = `âœ… (${í• ì¸ìœ¨})`;
        } else if (ì¼ì¹˜) {
          ê²€ì¦ìƒíƒœ = 'ì¼ì¹˜';
          ê²€ì¦ë©”ì‹œì§€ = `âœ… (${í• ì¸ìœ¨}, ì°¨ì´: ${ì°¨ì´.toLocaleString()}ì›)`;
        } else {
          ê²€ì¦ìƒíƒœ = 'ë¶ˆì¼ì¹˜';
          ê²€ì¦ë©”ì‹œì§€ = `âŒ (ì°¨ì´: ${ì°¨ì´.toLocaleString()}ì›)`;
          // ë¶ˆì¼ì¹˜ì¸ ê²½ìš° ë‘ í• ì¸ìœ¨ ëª¨ë‘ì˜ ê³„ì‚°ê°’ í‘œì‹œ
          const ì¶”ê°€ì •ë³´ = `[30%: ${ì›ë³¸ê°€ê²©_30.toLocaleString()}, 10%: ${ì›ë³¸ê°€ê²©_10.toLocaleString()}]`;
          ê²€ì¦ë©”ì‹œì§€ += ` ${ì¶”ê°€ì •ë³´}`;
        }
        
        ê²€ì¦í–‰.push(ì›ë³¸ê°€ê²©);
        ê²€ì¦í–‰.push(ê°€ê²©íŒŒì¼ê°€ê²©);
        ê²€ì¦í–‰.push(ê²€ì¦ë©”ì‹œì§€);
        
        if (ê²€ì¦ìƒíƒœ === 'ë¶ˆì¼ì¹˜') {
          ëª¨ë‘ì¼ì¹˜ = false;
          ê²€ì¦ìƒì„¸.push(`${ì˜µì…˜}: ${ì°¨ì´.toLocaleString()}ì› ì°¨ì´`);
        }
      }
      
      ê²€ì¦í–‰[2] = ëª¨ë‘ì¼ì¹˜ ? 'âœ… ì¼ì¹˜' : 'âš ï¸ ë¶ˆì¼ì¹˜';
      ê²€ì¦í–‰[3] = ìƒí’ˆí• ì¸ìœ¨ || 'í˜¼í•©'; // í• ì¸ìœ¨ í‘œì‹œ
      ê²€ì¦í–‰.push(ëª¨ë‘ì¼ì¹˜ ? 'âœ… ì „ì²´ì¼ì¹˜' : 'âŒ ë¶ˆì¼ì¹˜');
      
      // ë¹„ê³ ë€ì— ë§¤ì¹­ ì •ë³´ ì¶”ê°€
      let ë¹„ê³  = ê²€ì¦ìƒì„¸.join(', ') || '';
      
      // ë§¤ì¹­ ì •ë³´ ì¶”ê°€
      if (ë§¤ì¹­ëœí‚¤ !== ì œí’ˆëª…) {
        ë¹„ê³  = `[ë§¤ì¹­: ${ë§¤ì¹­ëœí‚¤}] ${ë¹„ê³ }`;
      }
      
      ê²€ì¦í–‰.push(ë¹„ê³ );
      
      ê²€ì¦ê²°ê³¼.push(ê²€ì¦í–‰);
      
      if (ëª¨ë‘ì¼ì¹˜) {
        ì¼ì¹˜ìƒí’ˆìˆ˜++;
        // í• ì¸ìœ¨ í†µê³„
        if (ìƒí’ˆí• ì¸ìœ¨ === '10%') {
          í• ì¸ìœ¨10_ìƒí’ˆìˆ˜++;
        } else if (ìƒí’ˆí• ì¸ìœ¨ === '30%') {
          í• ì¸ìœ¨30_ìƒí’ˆìˆ˜++;
        } else {
          í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜++;
        }
      } else {
        ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜++;
      }
    }
    
    // ê²°ê³¼ ì¶œë ¥
    if (ê²€ì¦ê²°ê³¼.length > 0) {
      ê²€ì¦ì‹œíŠ¸.getRange(2, 1, ê²€ì¦ê²°ê³¼.length, headers.length).setValues(ê²€ì¦ê²°ê³¼);
      
      // ìƒíƒœë³„ ìƒ‰ìƒ ì ìš©
      for (let i = 0; i < ê²€ì¦ê²°ê³¼.length; i++) {
        const ìƒíƒœ = ê²€ì¦ê²°ê³¼[i][2];
        const rowRange = ê²€ì¦ì‹œíŠ¸.getRange(i + 2, 1, 1, headers.length);
        
        if (ìƒíƒœ === 'âœ… ì¼ì¹˜') {
          rowRange.setBackground('#d4edda'); // ì´ˆë¡ìƒ‰
        } else if (ìƒíƒœ === 'âš ï¸ ë¶ˆì¼ì¹˜') {
          rowRange.setBackground('#fff3cd'); // ë…¸ë€ìƒ‰
        } else if (ìƒíƒœ === 'âŒ ë¯¸ë§¤ì¹­') {
          rowRange.setBackground('#f8d7da'); // ë¹¨ê°„ìƒ‰
        }
      }
    }
    
    // ë¯¸ë§¤ì¹­ ì›ë³¸ìƒí’ˆ ì¶œë ¥
    if (ë¯¸ë§¤ì¹­ì›ë³¸.length > 0) {
      ë¯¸ë§¤ì¹­ì‹œíŠ¸.getRange(2, 1, ë¯¸ë§¤ì¹­ì›ë³¸.length, ë¯¸ë§¤ì¹­í—¤ë”.length).setValues(ë¯¸ë§¤ì¹­ì›ë³¸);
      ë¯¸ë§¤ì¹­ì‹œíŠ¸.getRange(2, 1, ë¯¸ë§¤ì¹­ì›ë³¸.length, ë¯¸ë§¤ì¹­í—¤ë”.length).setBackground('#ffe6e6');
    }
    
    // ìš”ì•½ ì •ë³´
    const ìš”ì•½í–‰ = ê²€ì¦ì‹œíŠ¸.getLastRow() + 2;
    const rangeText = startNum && endNum ? ` (${startNum}ë²ˆ ~ ${endNum}ë²ˆ)` : '';
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰, 1).setValue(`ğŸ“Š ê²€ì¦ ìš”ì•½${rangeText}`).setFontWeight('bold');
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 1, 1).setValue(`âœ… ì „ì²´ ìƒí’ˆ: ${ì „ì²´ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 2, 1).setValue(`âœ… ì¼ì¹˜: ${ì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 3, 1).setValue(`âš ï¸ ë¶ˆì¼ì¹˜: ${ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 4, 1).setValue(`âŒ ë¯¸ë§¤ì¹­: ${ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜}ê°œ`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 5, 1).setValue(`â„¹ï¸ í—ˆìš©ì˜¤ì°¨: ${í—ˆìš©ì˜¤ì°¨.toLocaleString()}ì›`);
    ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 6, 1).setValue(`â„¹ï¸ í• ì¸ìœ¨: 30% ë˜ëŠ” 10% ìë™ ê°ì§€`);
    
    // í• ì¸ìœ¨ í†µê³„
    if (ì¼ì¹˜ìƒí’ˆìˆ˜ > 0) {
      ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 7, 1).setValue('ğŸ“Š í• ì¸ìœ¨ í†µê³„').setFontWeight('bold');
      ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 8, 1).setValue(`- 30% í• ì¸: ${í• ì¸ìœ¨30_ìƒí’ˆìˆ˜}ê°œ`);
      ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 9, 1).setValue(`- 10% í• ì¸: ${í• ì¸ìœ¨10_ìƒí’ˆìˆ˜}ê°œ`);
      if (í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜ > 0) {
        ê²€ì¦ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 10, 1).setValue(`- í˜¼í•©: ${í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜}ê°œ`);
      }
    }
    
    const message = `âœ… ì˜µì…˜ ê°€ê²© ê²€ì¦ ì™„ë£Œ${rangeText}!\n\n` +
                   `ì „ì²´ ìƒí’ˆ: ${ì „ì²´ìƒí’ˆìˆ˜}ê°œ\n` +
                   `ì¼ì¹˜: ${ì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ\n` +
                   `ë¶ˆì¼ì¹˜: ${ë¶ˆì¼ì¹˜ìƒí’ˆìˆ˜}ê°œ\n` +
                   `ë¯¸ë§¤ì¹­: ${ë¯¸ë§¤ì¹­ìƒí’ˆìˆ˜}ê°œ\n\n` +
                   `í• ì¸ìœ¨ í†µê³„:\n` +
                   `- 30% í• ì¸: ${í• ì¸ìœ¨30_ìƒí’ˆìˆ˜}ê°œ\n` +
                   `- 10% í• ì¸: ${í• ì¸ìœ¨10_ìƒí’ˆìˆ˜}ê°œ\n` +
                   (í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜ > 0 ? `- í˜¼í•©: ${í• ì¸ìœ¨í˜¼í•©_ìƒí’ˆìˆ˜}ê°œ\n` : '') +
                   `\nâ€» ${í—ˆìš©ì˜¤ì°¨.toLocaleString()}ì› ì´ë‚´ ì°¨ì´ëŠ” ì¼ì¹˜ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.\n` +
                   `â€» 30% ë˜ëŠ” 10% í• ì¸ìœ¨ì„ ìë™ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤.`;
    
    ui.alert(message);
    
  } catch (error) {
    console.error('ì˜¤ë¥˜:', error);
    ui.alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== ì œí’ˆëª… ìœ ì—°í•œ ë§¤ì¹­ í•¨ìˆ˜ ==========
function findMatchingProduct(ì œí’ˆëª…, ê°€ê²©ë§µ) {
  // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°
  let ê°€ê²©ì •ë³´ = ê°€ê²©ë§µ.get(ì œí’ˆëª…);
  if (ê°€ê²©ì •ë³´) {
    return { ê°€ê²©ì •ë³´: ê°€ê²©ì •ë³´, ë§¤ì¹­í‚¤: ì œí’ˆëª… };
  }
  
  // íŠ¹ìˆ˜ë¬¸ìì™€ ê³µë°±ì„ í‘œì¤€í™”í•˜ì—¬ ë¹„êµ
  const í‘œì¤€í™”í•¨ìˆ˜ = (text) => {
    return text
      .replace(/[\[\]()]/g, '') // ëŒ€ê´„í˜¸, ì†Œê´„í˜¸ ì œê±°
      .replace(/\s+/g, ' ')      // ë‹¤ì¤‘ ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ
      .trim();                   // ì•ë’¤ ê³µë°± ì œê±°
  };
  
  const í‘œì¤€í™”ì œí’ˆëª… = í‘œì¤€í™”í•¨ìˆ˜(ì œí’ˆëª…);
  
  // ê°€ì¥ ì •í™•í•œ ë§¤ì¹­ì„ ì°¾ê¸° ìœ„í•œ ì ìˆ˜ ì‹œìŠ¤í…œ
  let ìµœê³ ì ìˆ˜ = 0;
  let ìµœì ë§¤ì¹­ = null;
  
  for (const [key, value] of ê°€ê²©ë§µ) {
    const í‘œì¤€í™”í‚¤ = í‘œì¤€í™”í•¨ìˆ˜(key);
    
    // 1. í‘œì¤€í™”ëœ ì´ë¦„ì´ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš° (ìµœìš°ì„ )
    if (í‘œì¤€í™”ì œí’ˆëª… === í‘œì¤€í™”í‚¤) {
      console.log(`í‘œì¤€í™” ë§¤ì¹­ ì„±ê³µ: "${ì œí’ˆëª…}" â†’ "${key}"`);
      return { ê°€ê²©ì •ë³´: value, ë§¤ì¹­í‚¤: key };
    }
    
    // 2. ë¶€ë¶„ ë§¤ì¹­ ì ìˆ˜ ê³„ì‚°
    let ì ìˆ˜ = 0;
    
    // í•œìª½ì´ ë‹¤ë¥¸ ìª½ì„ í¬í•¨í•˜ëŠ” ê²½ìš°
    if (í‘œì¤€í™”ì œí’ˆëª….includes(í‘œì¤€í™”í‚¤)) {
      ì ìˆ˜ = í‘œì¤€í™”í‚¤.length / í‘œì¤€í™”ì œí’ˆëª….length * 100;
    } else if (í‘œì¤€í™”í‚¤.includes(í‘œì¤€í™”ì œí’ˆëª…)) {
      ì ìˆ˜ = í‘œì¤€í™”ì œí’ˆëª….length / í‘œì¤€í™”í‚¤.length * 100;
    }
    
    // ìµœê³  ì ìˆ˜ ì—…ë°ì´íŠ¸
    if (ì ìˆ˜ > ìµœê³ ì ìˆ˜ && ì ìˆ˜ > 70) { // 70% ì´ìƒ ì¼ì¹˜í•´ì•¼ ë§¤ì¹­
      ìµœê³ ì ìˆ˜ = ì ìˆ˜;
      ìµœì ë§¤ì¹­ = { key: key, value: value };
    }
  }
  
  // ìµœì  ë§¤ì¹­ì´ ìˆìœ¼ë©´ ë°˜í™˜
  if (ìµœì ë§¤ì¹­) {
    console.log(`ìœ ì—°í•œ ë§¤ì¹­ ì„±ê³µ (${Math.round(ìµœê³ ì ìˆ˜)}%): "${ì œí’ˆëª…}" â†’ "${ìµœì ë§¤ì¹­.key}"`);
    return { ê°€ê²©ì •ë³´: ìµœì ë§¤ì¹­.value, ë§¤ì¹­í‚¤: ìµœì ë§¤ì¹­.key };
  }
  
  // ë§¤ì¹­ ì‹¤íŒ¨
  return { ê°€ê²©ì •ë³´: null, ë§¤ì¹­í‚¤: null };
}

// ========== ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (3í–‰ ë³‘í•© êµ¬ì¡° - ë²”ìœ„ ì§€ì •) ==========
function parsePriceFileWithRange(ê°€ê²©ë°ì´í„°, startNum, endNum) {
  const ê°€ê²©ë§µ = new Map();
  let íŒŒì‹±ëœì œí’ˆìˆ˜ = 0;
  
  // í—¤ë” í–‰ ê±´ë„ˆë›°ê³  ì‹œì‘
  for (let i = 1; i < ê°€ê²©ë°ì´í„°.length; i += 3) {
    const í–‰ë²ˆí˜¸ = Math.floor((i - 1) / 3) + 1; // 3í–‰ì´ 1ê°œ ì œí’ˆ
    
    // ë²”ìœ„ ì²´í¬
    if (startNum && endNum && (í–‰ë²ˆí˜¸ < startNum || í–‰ë²ˆí˜¸ > endNum)) continue;
    
    const ì œí’ˆëª… = String(ê°€ê²©ë°ì´í„°[i][5] || '').trim(); // Fì—´
    
    if (!ì œí’ˆëª…) continue;
    
    // 3í–‰ì´ í•˜ë‚˜ì˜ ì œí’ˆ (ë‚¨ìë‹¨í’ˆ, ì—¬ìë‹¨í’ˆ, ì»¤í”Œ ìˆœì„œ)
    const ë‚¨ìí–‰ = i;
    const ì—¬ìí–‰ = i + 1;
    const ì»¤í”Œí–‰ = i + 2;
    
    // ê²½ê³„ ì²´í¬
    if (ì—¬ìí–‰ >= ê°€ê²©ë°ì´í„°.length || ì»¤í”Œí–‰ >= ê°€ê²©ë°ì´í„°.length) continue;
    
    const ê°€ê²©ì •ë³´ = {
      // 14K ê°€ê²© (Oì—´: ì¿ í°ê°€ = ì‹¤ì œ íŒë§¤ê°€)
      '14Kë‚¨ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ë‚¨ìí–‰][14] || '0').replace(/,/g, '')) || 0,
      '14Kì—¬ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ì—¬ìí–‰][14] || '0').replace(/,/g, '')) || 0,
      '14Kì»¤í”Œ': parseFloat(String(ê°€ê²©ë°ì´í„°[ì»¤í”Œí–‰][14] || '0').replace(/,/g, '')) || 0,
      
      // 18K ê°€ê²© (ACì—´: ì¿ í°ê°€ = ì‹¤ì œ íŒë§¤ê°€)
      '18Kë‚¨ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ë‚¨ìí–‰][28] || '0').replace(/,/g, '')) || 0,
      '18Kì—¬ì': parseFloat(String(ê°€ê²©ë°ì´í„°[ì—¬ìí–‰][28] || '0').replace(/,/g, '')) || 0,
      '18Kì»¤í”Œ': parseFloat(String(ê°€ê²©ë°ì´í„°[ì»¤í”Œí–‰][28] || '0').replace(/,/g, '')) || 0,
      
      '_rowNumber': í–‰ë²ˆí˜¸ // ë²ˆí˜¸ ì €ì¥
    };
    
    ê°€ê²©ë§µ.set(ì œí’ˆëª…, ê°€ê²©ì •ë³´);
    íŒŒì‹±ëœì œí’ˆìˆ˜++;
  }
  
  console.log(`ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œ ${íŒŒì‹±ëœì œí’ˆìˆ˜}ê°œ ì œí’ˆ íŒŒì‹± ì™„ë£Œ`);
  return ê°€ê²©ë§µ;
}

// ========== ê°€ê²©ìˆ˜ì •íŒŒì¼ íŒŒì‹± (ê¸°ì¡´) ==========
function parsePriceFile(ê°€ê²©ë°ì´í„°) {
  return parsePriceFileWithRange(ê°€ê²©ë°ì´í„°, null, null);
}

// ========== ì›ë³¸ ì˜µì…˜ ê°€ê²© íŒŒì‹± ==========
function parseOriginalOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ì˜µì…˜ê°€ê²©ë¬¸ìì—´, íŒë§¤ê°€ê²©) {
  const ì˜µì…˜ê°€ê²© = {};
  
  // Eì—´ê³¼ Fì—´ íŒŒì‹±
  const ì˜µì…˜ëª…ë“¤ = ì˜µì…˜ëª…ë¬¸ìì—´.split(',').map(s => s.trim());
  const ê°€ê²©ì°¨ì´ë“¤ = ì˜µì…˜ê°€ê²©ë¬¸ìì—´.split(',').map(s => {
    const num = parseFloat(s.replace(/,/g, '').trim());
    return isNaN(num) ? 0 : num;
  });
  
  // ì˜µì…˜ ìˆœì„œ: 14Kì»¤í”Œë§, 14Kë‚¨ìë‹¨í’ˆ, 14Kì—¬ìë‹¨í’ˆ, 18Kì»¤í”Œë§, 18Kë‚¨ìë‹¨í’ˆ, 18Kì—¬ìë‹¨í’ˆ
  const ì˜µì…˜ë§¤í•‘ = {
    0: '14Kì»¤í”Œ',
    1: '14Kë‚¨ì',
    2: '14Kì—¬ì',
    3: '18Kì»¤í”Œ',
    4: '18Kë‚¨ì',
    5: '18Kì—¬ì'
  };
  
  // íŒë§¤ê°€ê²©(ABì—´)ì€ ì •ê°€!! 30% í• ì¸ê³¼ 10% í• ì¸ ëª¨ë‘ ê³„ì‚°
  for (let i = 0; i < ê°€ê²©ì°¨ì´ë“¤.length && i < 6; i++) {
    const ì˜µì…˜í‚¤ = ì˜µì…˜ë§¤í•‘[i];
    if (ì˜µì…˜í‚¤) {
      // 1. íŒë§¤ê°€ê²©(ì •ê°€) + Fì—´ ì°¨ì´ê°’ = ê° ì˜µì…˜ì˜ ì •ìƒê°€
      const ì •ìƒê°€ = íŒë§¤ê°€ê²© + ê°€ê²©ì°¨ì´ë“¤[i];
      
      // 2. 30% í• ì¸ê³¼ 10% í• ì¸ ëª¨ë‘ ê³„ì‚°
      const ì‹¤ì œíŒë§¤ê°€_30 = ì •ìƒê°€ * 0.7;
      const ì‹¤ì œíŒë§¤ê°€_10 = ì •ìƒê°€ * 0.9;
      
      // 3. ì²œì›ë‹¨ìœ„ ì˜¬ë¦¼
      ì˜µì…˜ê°€ê²©[ì˜µì…˜í‚¤] = Math.ceil(ì‹¤ì œíŒë§¤ê°€_30 / 1000) * 1000;  // 30% í• ì¸ ê¸°ë³¸ê°’
      ì˜µì…˜ê°€ê²©[ì˜µì…˜í‚¤ + '_10%'] = Math.ceil(ì‹¤ì œíŒë§¤ê°€_10 / 1000) * 1000;  // 10% í• ì¸ ë²„ì „
      ì˜µì…˜ê°€ê²©[ì˜µì…˜í‚¤ + '_ì •ìƒê°€'] = ì •ìƒê°€;
    }
  }
  
  return ì˜µì…˜ê°€ê²©;
}

// ========== ê°€ê²© ë³€ê²½ì‚¬í•­ ì°¾ê¸° (ìˆ˜ì •: ë²”ìœ„ ì§€ì •ëœ ì œí’ˆë§Œ) ==========
function findPriceChanges() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    // ë¨¼ì € ì „ì²´ ê²€ì¦ ì‹¤í–‰í•˜ì§€ ì•Šê³ , ê¸°ì¡´ ê²€ì¦ ê²°ê³¼ì—ì„œ ë¶ˆì¼ì¹˜ í•­ëª©ë§Œ ì¶”ì¶œ
    const ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì˜µì…˜ê²€ì¦ì‹œíŠ¸);
    const ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName('10Kê²€ì¦ê²°ê³¼');
    
    if (!ê²€ì¦ì‹œíŠ¸) {
      ui.alert('âŒ ê²€ì¦ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê°€ê²© ê²€ì¦ì„ ì‹¤í–‰í•˜ì„¸ìš”.');
      return;
    }
    
    // ë³€ê²½ë‚´ì—­ ì‹œíŠ¸ ìƒì„±
    let ë³€ê²½ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë³€ê²½ë‚´ì—­ì‹œíŠ¸);
    if (!ë³€ê²½ì‹œíŠ¸) {
      ë³€ê²½ì‹œíŠ¸ = ss.insertSheet(CONFIG.ë³€ê²½ë‚´ì—­ì‹œíŠ¸);
    } else {
      ë³€ê²½ì‹œíŠ¸.clear();
    }
    
    // í—¤ë”
    const headers = [
      'ë²ˆí˜¸', 'ì œí’ˆëª…', 'ì˜µì…˜', 'ì›ë³¸ê°€ê²©', 'ì‹ ê·œê°€ê²©', 'ê°€ê²©ì°¨ì´', 'ë³€ê²½íƒ€ì…', 
      '30%í• ì¸ê°€', 'ì œí’ˆíƒ€ì…'
    ];
    
    ë³€ê²½ì‹œíŠ¸.getRange(1, 1, 1, headers.length).setValues([headers]);
    ë³€ê²½ì‹œíŠ¸.getRange(1, 1, 1, headers.length)
      .setFontWeight('bold')
      .setBackground('#f0ad4e')
      .setFontColor('#ffffff');
    
    const ë³€ê²½ë‚´ì—­ = [];
    
    // 14K/18K ë¶ˆì¼ì¹˜ í•­ëª© ì¶”ì¶œ
    const ê²€ì¦ë°ì´í„° = ê²€ì¦ì‹œíŠ¸.getDataRange().getValues();
    
    for (let i = 1; i < ê²€ì¦ë°ì´í„°.length; i++) {
      const row = ê²€ì¦ë°ì´í„°[i];
      if (row[2] === 'âš ï¸ ë¶ˆì¼ì¹˜') {
        const ë²ˆí˜¸ = row[0];
        const ì œí’ˆëª… = row[1];
        
        // ê° ì˜µì…˜ë³„ë¡œ ë³€ê²½ì‚¬í•­ í™•ì¸
        const ì˜µì…˜ì •ë³´ = [
          { name: '14Kì»¤í”Œ', ì›ë³¸: row[4], ì‹ ê·œ: row[5], ê²€ì¦: row[6] },
          { name: '14Kë‚¨ì', ì›ë³¸: row[7], ì‹ ê·œ: row[8], ê²€ì¦: row[9] },
          { name: '14Kì—¬ì', ì›ë³¸: row[10], ì‹ ê·œ: row[11], ê²€ì¦: row[12] },
          { name: '18Kì»¤í”Œ', ì›ë³¸: row[13], ì‹ ê·œ: row[14], ê²€ì¦: row[15] },
          { name: '18Kë‚¨ì', ì›ë³¸: row[16], ì‹ ê·œ: row[17], ê²€ì¦: row[18] },
          { name: '18Kì—¬ì', ì›ë³¸: row[19], ì‹ ê·œ: row[20], ê²€ì¦: row[21] }
        ];
        
        for (const ì˜µì…˜ of ì˜µì…˜ì •ë³´) {
          // ê²€ì¦ ê²°ê³¼ê°€ âŒë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°ë§Œ (10000ì› ì´ˆê³¼ ì°¨ì´)
          if (ì˜µì…˜.ê²€ì¦.toString().startsWith('âŒ') && ì˜µì…˜.ì›ë³¸ && ì˜µì…˜.ì‹ ê·œ) {
            const ì°¨ì´ = ì˜µì…˜.ì‹ ê·œ - ì˜µì…˜.ì›ë³¸;
            const í• ì¸ê°€ = Math.round(ì˜µì…˜.ì‹ ê·œ * 0.7);
            const ë³€ê²½íƒ€ì… = ì°¨ì´ > 0 ? 'ğŸ“ˆ ì¸ìƒ' : 'ğŸ“‰ ì¸í•˜';
            
            // ê°€ê²©ì°¨ì´ë¥¼ ë” ì½ê¸° ì‰½ê²Œ í‘œì‹œ
            const ê°€ê²©ì°¨ì´í‘œì‹œ = ì°¨ì´ > 0 
              ? `+${ì°¨ì´.toLocaleString()}ì›` 
              : `${ì°¨ì´.toLocaleString()}ì›`;
            
            ë³€ê²½ë‚´ì—­.push([
              ë²ˆí˜¸,
              ì œí’ˆëª…,
              ì˜µì…˜.name,
              ì˜µì…˜.ì›ë³¸.toLocaleString() + 'ì›',
              ì˜µì…˜.ì‹ ê·œ.toLocaleString() + 'ì›',
              ê°€ê²©ì°¨ì´í‘œì‹œ,
              ë³€ê²½íƒ€ì…,
              í• ì¸ê°€.toLocaleString() + 'ì›',
              '14K/18K'
            ]);
          }
        }
      }
    }
    
    // 10K ë¶ˆì¼ì¹˜ í•­ëª© ì¶”ì¶œ
    if (ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸) {
      const ì‹­ì¼€ì´ë°ì´í„° = ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸.getDataRange().getValues();
      
      for (let i = 1; i < ì‹­ì¼€ì´ë°ì´í„°.length; i++) {
        const row = ì‹­ì¼€ì´ë°ì´í„°[i];
        if (row[3] === 'âš ï¸ ë¶ˆì¼ì¹˜') {
          const ë²ˆí˜¸ = row[0];
          const ì œí’ˆëª… = row[1];
          
          const ì˜µì…˜ì •ë³´ = [
            { name: '10Kì»¤í”Œ', ì›ë³¸: row[4], ì‹ ê·œ: row[5], ê²€ì¦: row[6] },
            { name: '10Kë‚¨ì', ì›ë³¸: row[7], ì‹ ê·œ: row[8], ê²€ì¦: row[9] },
            { name: '10Kì—¬ì', ì›ë³¸: row[10], ì‹ ê·œ: row[11], ê²€ì¦: row[12] }
          ];
          
          for (const ì˜µì…˜ of ì˜µì…˜ì •ë³´) {
            if (ì˜µì…˜.ê²€ì¦.toString().startsWith('âŒ') && ì˜µì…˜.ì›ë³¸ && ì˜µì…˜.ì‹ ê·œ) {
              const ì°¨ì´ = ì˜µì…˜.ì‹ ê·œ - ì˜µì…˜.ì›ë³¸;
              const í• ì¸ê°€ = Math.round(ì˜µì…˜.ì‹ ê·œ * 0.7);
              const ë³€ê²½íƒ€ì… = ì°¨ì´ > 0 ? 'ğŸ“ˆ ì¸ìƒ' : 'ğŸ“‰ ì¸í•˜';
              
              const ê°€ê²©ì°¨ì´í‘œì‹œ = ì°¨ì´ > 0 
                ? `+${ì°¨ì´.toLocaleString()}ì›` 
                : `${ì°¨ì´.toLocaleString()}ì›`;
              
              ë³€ê²½ë‚´ì—­.push([
                ë²ˆí˜¸,
                ì œí’ˆëª…,
                ì˜µì…˜.name,
                ì˜µì…˜.ì›ë³¸.toLocaleString() + 'ì›',
                ì˜µì…˜.ì‹ ê·œ.toLocaleString() + 'ì›',
                ê°€ê²©ì°¨ì´í‘œì‹œ,
                ë³€ê²½íƒ€ì…,
                í• ì¸ê°€.toLocaleString() + 'ì›',
                '10K'
              ]);
            }
          }
        }
      }
    }
    
    // ê²°ê³¼ ì¶œë ¥
    if (ë³€ê²½ë‚´ì—­.length > 0) {
      ë³€ê²½ì‹œíŠ¸.getRange(2, 1, ë³€ê²½ë‚´ì—­.length, headers.length).setValues(ë³€ê²½ë‚´ì—­);
      
      // ë³€ê²½ íƒ€ì…ë³„ ìƒ‰ìƒ + ê°€ê²©ì°¨ì´ ì—´ ê°•ì¡°
      for (let i = 0; i < ë³€ê²½ë‚´ì—­.length; i++) {
        const ë³€ê²½íƒ€ì… = ë³€ê²½ë‚´ì—­[i][6];
        const ì œí’ˆíƒ€ì… = ë³€ê²½ë‚´ì—­[i][8];
        const rowRange = ë³€ê²½ì‹œíŠ¸.getRange(i + 2, 1, 1, headers.length);
        
        if (ë³€ê²½íƒ€ì… === 'ğŸ“ˆ ì¸ìƒ') {
          rowRange.setBackground('#ffe6e6'); // ì—°í•œ ë¹¨ê°•
        } else if (ë³€ê²½íƒ€ì… === 'ğŸ“‰ ì¸í•˜') {
          rowRange.setBackground('#e6f3ff'); // ì—°í•œ íŒŒë‘
        }
        
        // ê°€ê²©ì°¨ì´ ì—´ êµµê²Œ í‘œì‹œ
        ë³€ê²½ì‹œíŠ¸.getRange(i + 2, 6).setFontWeight('bold').setFontSize(11);
        
        // 10K ì œí’ˆì€ ê¸ˆìƒ‰ í…Œë‘ë¦¬
        if (ì œí’ˆíƒ€ì… === '10K') {
          rowRange.setBorder(true, true, true, true, true, true, '#FFD700', SpreadsheetApp.BorderStyle.SOLID_MEDIUM);
        }
      }
      
      // ìš”ì•½ ì •ë³´
      let ì´ì¸ìƒì•¡ = 0;
      let ì´ì¸í•˜ì•¡ = 0;
      let ì¸ìƒê±´ìˆ˜ = 0;
      let ì¸í•˜ê±´ìˆ˜ = 0;
      
      for (const ë³€ê²½ of ë³€ê²½ë‚´ì—­) {
        const ì°¨ì´ê¸ˆì•¡ = parseInt(ë³€ê²½[5].replace(/[^-\d]/g, ''));
        if (ì°¨ì´ê¸ˆì•¡ > 0) {
          ì´ì¸ìƒì•¡ += ì°¨ì´ê¸ˆì•¡;
          ì¸ìƒê±´ìˆ˜++;
        } else {
          ì´ì¸í•˜ì•¡ += Math.abs(ì°¨ì´ê¸ˆì•¡);
          ì¸í•˜ê±´ìˆ˜++;
        }
      }
      
      const ìš”ì•½í–‰ = ë³€ê²½ë‚´ì—­.length + 3;
      ë³€ê²½ì‹œíŠ¸.getRange(ìš”ì•½í–‰, 1).setValue('ğŸ“Š ë³€ê²½ ìš”ì•½').setFontWeight('bold');
      ë³€ê²½ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 1, 1).setValue(`ğŸ“ˆ ì¸ìƒ: ${ì¸ìƒê±´ìˆ˜}ê±´ (ì´ +${ì´ì¸ìƒì•¡.toLocaleString()}ì›)`);
      ë³€ê²½ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 2, 1).setValue(`ğŸ“‰ ì¸í•˜: ${ì¸í•˜ê±´ìˆ˜}ê±´ (ì´ -${ì´ì¸í•˜ì•¡.toLocaleString()}ì›)`);
      ë³€ê²½ì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 3, 1).setValue(`ğŸ’° ìˆœ ë³€ë™: ${(ì´ì¸ìƒì•¡ - ì´ì¸í•˜ì•¡).toLocaleString()}ì›`);
      
      ui.alert(`âœ… ê°€ê²© ë³€ê²½ì‚¬í•­ ì°¾ê¸° ì™„ë£Œ!\n\n` +
              `ì´ ${ë³€ê²½ë‚´ì—­.length}ê°œ ì˜µì…˜ ë³€ê²½\n` +
              `ğŸ“ˆ ì¸ìƒ: ${ì¸ìƒê±´ìˆ˜}ê±´ (+${ì´ì¸ìƒì•¡.toLocaleString()}ì›)\n` +
              `ğŸ“‰ ì¸í•˜: ${ì¸í•˜ê±´ìˆ˜}ê±´ (-${ì´ì¸í•˜ì•¡.toLocaleString()}ì›)\n` +
              `ğŸ’° ìˆœ ë³€ë™: ${(ì´ì¸ìƒì•¡ - ì´ì¸í•˜ì•¡).toLocaleString()}ì›`);
    } else {
      ui.alert('â„¹ï¸ 10,000ì›ì„ ì´ˆê³¼í•˜ëŠ” ê°€ê²© ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    
  } catch (error) {
    ui.alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== ë©”ì´í¬ìƒµ ì—…ë¡œë“œ íŒŒì¼ ìƒì„± (ìˆ˜ì •: ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ì œí’ˆë§Œ) ==========
function createMakeshopUploadFile() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    const ë³€ê²½ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë³€ê²½ë‚´ì—­ì‹œíŠ¸);
    
    if (!ë³€ê²½ì‹œíŠ¸ || ë³€ê²½ì‹œíŠ¸.getLastRow() < 2) {
      ui.alert('âŒ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê°€ê²© ë³€ê²½ì‚¬í•­ì„ ì°¾ì•„ì£¼ì„¸ìš”.');
      return;
    }
    
    // ì—…ë¡œë“œ ì‹œíŠ¸ ìƒì„±
    let ì—…ë¡œë“œì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë©”ì´í¬ìƒµì—…ë¡œë“œì‹œíŠ¸);
    if (!ì—…ë¡œë“œì‹œíŠ¸) {
      ì—…ë¡œë“œì‹œíŠ¸ = ss.insertSheet(CONFIG.ë©”ì´í¬ìƒµì—…ë¡œë“œì‹œíŠ¸);
    } else {
      ì—…ë¡œë“œì‹œíŠ¸.clear();
    }
    
    // ë©”ì´í¬ìƒµ ì¼ê´„ë“±ë¡ ì–‘ì‹ í—¤ë”
    const headers = [
      'ìƒí’ˆì½”ë“œ', 'íŒë§¤ê°€ê²©', 'ì˜µì…˜íƒ€ì…', 'ì˜µì…˜ëª…', 'ì˜µì…˜ê°’', 
      'ì˜µì…˜ì¶”ê°€ê¸ˆì•¡', 'ì˜µì…˜ì¬ê³ ìˆ˜ëŸ‰', 'ì›ê°€', 'ì •ê°€', 'ì˜µì…˜ì •ë ¬ìˆœì„œ'
    ];
    
    ì—…ë¡œë“œì‹œíŠ¸.getRange(1, 1, 1, headers.length).setValues([headers]);
    ì—…ë¡œë“œì‹œíŠ¸.getRange(1, 1, 1, headers.length)
      .setFontWeight('bold')
      .setBackground('#28a745')
      .setFontColor('#ffffff');
    
    // ì›ë³¸ë°ì´í„°ì—ì„œ ìƒí’ˆì½”ë“œ ë§¤í•‘
    const ì›ë³¸ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì›ë³¸ë°ì´í„°ì‹œíŠ¸);
    const ì›ë³¸ë°ì´í„° = ì›ë³¸ì‹œíŠ¸.getDataRange().getValues();
    const ìƒí’ˆì½”ë“œë§µ = new Map();
    const ìƒí’ˆì˜µì…˜ê°€ê²©ë§µ = new Map();
    
    for (let i = 1; i < ì›ë³¸ë°ì´í„°.length; i++) {
      const ìƒí’ˆì½”ë“œ = ì›ë³¸ë°ì´í„°[i][1]; // Bì—´
      const ì œí’ˆëª… = ì›ë³¸ë°ì´í„°[i][0]; // Aì—´
      const íŒë§¤ê°€ê²© = parseFloat(String(ì›ë³¸ë°ì´í„°[i][27] || '0').replace(/,/g, '')); // ABì—´
      const ì˜µì…˜ëª…ë¬¸ìì—´ = String(ì›ë³¸ë°ì´í„°[i][4] || ''); // Eì—´
      const ì˜µì…˜ê°€ê²©ë¬¸ìì—´ = String(ì›ë³¸ë°ì´í„°[i][5] || ''); // Fì—´
      
      if (ìƒí’ˆì½”ë“œ && ì œí’ˆëª…) {
        ìƒí’ˆì½”ë“œë§µ.set(ì œí’ˆëª….trim(), ìƒí’ˆì½”ë“œ);
        
        // ì›ë³¸ ì˜µì…˜ ê°€ê²© íŒŒì‹±í•˜ì—¬ ì €ì¥
        const ì›ë³¸ì˜µì…˜ê°€ê²© = parseOriginalOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ì˜µì…˜ê°€ê²©ë¬¸ìì—´, íŒë§¤ê°€ê²©);
        ìƒí’ˆì˜µì…˜ê°€ê²©ë§µ.set(ì œí’ˆëª….trim(), ì›ë³¸ì˜µì…˜ê°€ê²©);
      }
    }
    
    // 10K ë°ì´í„°ì—ì„œë„ ìƒí’ˆì½”ë“œ ë§¤í•‘
    const ì‹­ì¼€ì´ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸);
    if (ì‹­ì¼€ì´ì‹œíŠ¸) {
      const ì‹­ì¼€ì´ë°ì´í„° = ì‹­ì¼€ì´ì‹œíŠ¸.getDataRange().getValues();
      for (let i = 1; i < ì‹­ì¼€ì´ë°ì´í„°.length; i++) {
        const ì‹­ì¼€ì´ì œí’ˆëª… = ì‹­ì¼€ì´ë°ì´í„°[i][0]; // Aì—´
        const ì˜µì…˜ëª…ë¬¸ìì—´ = String(ì‹­ì¼€ì´ë°ì´í„°[i][44] || ''); // ASì—´
        const ê°€ê²©ì°¨ì´ë¬¸ìì—´ = String(ì‹­ì¼€ì´ë°ì´í„°[i][45] || ''); // ATì—´
        const íŒë§¤ê°€ê²© = parseFloat(String(ì‹­ì¼€ì´ë°ì´í„°[i][27] || '0').replace(/,/g, '')); // ABì—´
        
        if (ì‹­ì¼€ì´ì œí’ˆëª…) {
          // 10K ì œí’ˆëª…ì—ì„œ "10k" ì œê±°í•œ ì´ë¦„ìœ¼ë¡œ ì›ë³¸ë°ì´í„°ì—ì„œ ìƒí’ˆì½”ë“œ ì°¾ê¸°
          let ì›ë³¸ì œí’ˆëª… = ì‹­ì¼€ì´ì œí’ˆëª…;
          if (ì‹­ì¼€ì´ì œí’ˆëª….toLowerCase().startsWith('10k')) {
            ì›ë³¸ì œí’ˆëª… = ì‹­ì¼€ì´ì œí’ˆëª….substring(3).trim();
          }
          
          // ì›ë³¸ë°ì´í„°ì—ì„œ ìƒí’ˆì½”ë“œ ì°¾ê¸°
          for (let j = 1; j < ì›ë³¸ë°ì´í„°.length; j++) {
            const ì›ë³¸ìƒí’ˆëª… = String(ì›ë³¸ë°ì´í„°[j][0] || '').trim(); // Aì—´
            const ì›ë³¸ìƒí’ˆì½”ë“œ = String(ì›ë³¸ë°ì´í„°[j][1] || '').trim(); // Bì—´
            
            if (ì›ë³¸ìƒí’ˆëª… === ì›ë³¸ì œí’ˆëª… && ì›ë³¸ìƒí’ˆì½”ë“œ) {
              ìƒí’ˆì½”ë“œë§µ.set(ì‹­ì¼€ì´ì œí’ˆëª….trim(), ì›ë³¸ìƒí’ˆì½”ë“œ);
              
              // 10K ì˜µì…˜ ê°€ê²© íŒŒì‹±í•˜ì—¬ ì €ì¥
              const ì‹­ì¼€ì´ì˜µì…˜ê°€ê²© = parse10KOptions(ì˜µì…˜ëª…ë¬¸ìì—´, ê°€ê²©ì°¨ì´ë¬¸ìì—´, íŒë§¤ê°€ê²©);
              ìƒí’ˆì˜µì…˜ê°€ê²©ë§µ.set(ì‹­ì¼€ì´ì œí’ˆëª….trim(), ì‹­ì¼€ì´ì˜µì…˜ê°€ê²©);
              break;
            }
          }
        }
      }
    }
    
    // ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œ ì‹ ê·œ ê°€ê²© ê°€ì ¸ì˜¤ê¸°
    const ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    const ê°€ê²©ë°ì´í„° = ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
    const ì‹ ê·œê°€ê²©ë§µ = parsePriceFile(ê°€ê²©ë°ì´í„°);
    
    // 10K ê°€ê²©ìˆ˜ì •íŒŒì¼ì—ì„œë„ ì‹ ê·œ ê°€ê²© ê°€ì ¸ì˜¤ê¸°
    const ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    if (ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸) {
      const ì‹­ì¼€ì´ê°€ê²©ë°ì´í„° = ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸.getDataRange().getValues();
      const ì‹­ì¼€ì´ì‹ ê·œê°€ê²©ë§µ = parse10KPriceFile(ì‹­ì¼€ì´ê°€ê²©ë°ì´í„°);
      
      // 10K ê°€ê²© ì •ë³´ë¥¼ ì‹ ê·œê°€ê²©ë§µì— ë³‘í•©
      for (const [ì œí’ˆëª…, ê°€ê²©ì •ë³´] of ì‹­ì¼€ì´ì‹ ê·œê°€ê²©ë§µ) {
        ì‹ ê·œê°€ê²©ë§µ.set(ì œí’ˆëª…, ê°€ê²©ì •ë³´);
      }
    }
    
    // ë³€ê²½ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const ë³€ê²½ë°ì´í„° = ë³€ê²½ì‹œíŠ¸.getDataRange().getValues();
    
    // ì œí’ˆë³„ë¡œ ê·¸ë£¹í™” (ë³€ê²½ëœ ì œí’ˆë§Œ ì¶”ì¶œ)
    const ë³€ê²½ì œí’ˆëª©ë¡ = new Set();
    
    for (let i = 1; i < ë³€ê²½ë°ì´í„°.length; i++) {
      const row = ë³€ê²½ë°ì´í„°[i];
      const ì œí’ˆëª… = row[1];
      ë³€ê²½ì œí’ˆëª©ë¡.add(ì œí’ˆëª…);
    }
    
    const uploadData = [];
    const ì˜µì…˜ìˆœì„œë§µ = {
      '14Kì»¤í”Œ': 1,
      '14Kë‚¨ì': 2,
      '14Kì—¬ì': 3,
      '18Kì»¤í”Œ': 4,
      '18Kë‚¨ì': 5,
      '18Kì—¬ì': 6,
      '10Kì»¤í”Œ': 7,
      '10Kë‚¨ì': 8,
      '10Kì—¬ì': 9
    };
    
    // ê° ë³€ê²½ëœ ì œí’ˆë³„ë¡œ ëª¨ë“  ì˜µì…˜ì„ í¬í•¨í•˜ì—¬ ì—…ë¡œë“œ ë°ì´í„° ìƒì„±
    ë³€ê²½ì œí’ˆëª©ë¡.forEach(ì œí’ˆëª… => {
      const ìƒí’ˆì½”ë“œ = ìƒí’ˆì½”ë“œë§µ.get(ì œí’ˆëª…);
      
      if (!ìƒí’ˆì½”ë“œ) {
        console.log(`ìƒí’ˆì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${ì œí’ˆëª…}`);
        return;
      }
      
      // ì‹ ê·œ ê°€ê²© ì •ë³´ ì°¾ê¸° (ìœ ì—°í•œ ë§¤ì¹­ ì ìš©)
      const ë§¤ì¹­ê²°ê³¼ = findMatchingProduct(ì œí’ˆëª…, ì‹ ê·œê°€ê²©ë§µ);
      const ì‹ ê·œê°€ê²©ì •ë³´ = ë§¤ì¹­ê²°ê³¼.ê°€ê²©ì •ë³´;
      
      if (!ì‹ ê·œê°€ê²©ì •ë³´) {
        console.log(`ì‹ ê·œ ê°€ê²© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${ì œí’ˆëª…}`);
        return;
      }
      
      // ì›ë³¸ ê°€ê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const ì›ë³¸ê°€ê²©ì •ë³´ = ìƒí’ˆì˜µì…˜ê°€ê²©ë§µ.get(ì œí’ˆëª…);
      
      // ì œí’ˆ íƒ€ì… í™•ì¸ (10Kì¸ì§€ 14K/18Kì¸ì§€)
      const ì œí’ˆíƒ€ì… = ì œí’ˆëª….toLowerCase().includes('10k') ? '10K' : '14K/18K';
      
      // ê¸°ì¤€ê°€ê²© ì°¾ê¸°
      let ê¸°ì¤€ê°€ê²©;
      if (ì œí’ˆíƒ€ì… === '10K') {
        ê¸°ì¤€ê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´['10Kì»¤í”Œ'] || 0;
      } else {
        ê¸°ì¤€ê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´['14Kì»¤í”Œ'] || 0;
      }
      
      // ê¸°ì¤€ê°€ê²©ì´ ì—†ìœ¼ë©´ ì›ë³¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°
      if (!ê¸°ì¤€ê°€ê²© && ì›ë³¸ê°€ê²©ì •ë³´) {
        if (ì œí’ˆíƒ€ì… === '10K') {
          ê¸°ì¤€ê°€ê²© = ì›ë³¸ê°€ê²©ì •ë³´['10Kì»¤í”Œ'] || 0;
        } else {
          ê¸°ì¤€ê°€ê²© = ì›ë³¸ê°€ê²©ì •ë³´['14Kì»¤í”Œ'] || 0;
        }
      }
      
      // ë©”ì¸ ìƒí’ˆ ì •ë³´
      uploadData.push([
        ìƒí’ˆì½”ë“œ,
        ê¸°ì¤€ê°€ê²©,
        'SELECT',
        '',
        '',
        '',
        '',
        Math.round(ê¸°ì¤€ê°€ê²© * 0.3), // ì›ê°€
        Math.ceil((ê¸°ì¤€ê°€ê²© / 0.7) / 1000) * 1000, // ì •ê°€
        ''
      ]);
      
      // ëª¨ë“  ì˜µì…˜ ì •ë³´ ì¶”ê°€
      if (ì œí’ˆíƒ€ì… === '10K') {
        // 10K ì˜µì…˜ë“¤
        const ì˜µì…˜ëª©ë¡ = ['10Kì»¤í”Œ', '10Kë‚¨ì', '10Kì—¬ì'];
        
        ì˜µì…˜ëª©ë¡.forEach(ì˜µì…˜ => {
          // ì‹ ê·œ ê°€ê²©ì´ ìˆìœ¼ë©´ ì‹ ê·œ ê°€ê²© ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ ê°€ê²© ì‚¬ìš©
          const ì˜µì…˜ê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´[ì˜µì…˜] || (ì›ë³¸ê°€ê²©ì •ë³´ ? ì›ë³¸ê°€ê²©ì •ë³´[ì˜µì…˜] : 0) || 0;
          const ì¶”ê°€ê¸ˆì•¡ = ì˜µì…˜ê°€ê²© - ê¸°ì¤€ê°€ê²©;
          const ì˜µì…˜í‘œì‹œëª… = `${ì˜µì…˜.replace('ì»¤í”Œ', 'ì»¤í”Œë§').replace('ë‚¨ì', 'ë‚¨ìë‹¨í’ˆ').replace('ì—¬ì', 'ì—¬ìë‹¨í’ˆ')}`;
          
          uploadData.push([
            ìƒí’ˆì½”ë“œ,
            '',
            '',
            'ìƒí’ˆì„ íƒ',
            ì˜µì…˜í‘œì‹œëª…,
            ì¶”ê°€ê¸ˆì•¡,
            999,
            '',
            '',
            ì˜µì…˜ìˆœì„œë§µ[ì˜µì…˜] || 99
          ]);
        });
      } else {
        // 14K/18K ì˜µì…˜ë“¤
        const ì˜µì…˜ëª©ë¡ = ['14Kì»¤í”Œ', '14Kë‚¨ì', '14Kì—¬ì', '18Kì»¤í”Œ', '18Kë‚¨ì', '18Kì—¬ì'];
        
        ì˜µì…˜ëª©ë¡.forEach(ì˜µì…˜ => {
          // ì‹ ê·œ ê°€ê²©ì´ ìˆìœ¼ë©´ ì‹ ê·œ ê°€ê²© ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ ê°€ê²© ì‚¬ìš©
          const ì˜µì…˜ê°€ê²© = ì‹ ê·œê°€ê²©ì •ë³´[ì˜µì…˜] || (ì›ë³¸ê°€ê²©ì •ë³´ ? ì›ë³¸ê°€ê²©ì •ë³´[ì˜µì…˜] : 0) || 0;
          const ì¶”ê°€ê¸ˆì•¡ = ì˜µì…˜ê°€ê²© - ê¸°ì¤€ê°€ê²©;
          const ì˜µì…˜í‘œì‹œëª… = `${ì˜µì…˜.replace('ì»¤í”Œ', 'ì»¤í”Œë§').replace('ë‚¨ì', 'ë‚¨ìë‹¨í’ˆ').replace('ì—¬ì', 'ì—¬ìë‹¨í’ˆ')}`;
          
          uploadData.push([
            ìƒí’ˆì½”ë“œ,
            '',
            '',
            'ìƒí’ˆì„ íƒ',
            ì˜µì…˜í‘œì‹œëª…,
            ì¶”ê°€ê¸ˆì•¡,
            999,
            '',
            '',
            ì˜µì…˜ìˆœì„œë§µ[ì˜µì…˜] || 99
          ]);
        });
      }
    });
    
    // ë°ì´í„° ì¶œë ¥
    if (uploadData.length > 0) {
      ì—…ë¡œë“œì‹œíŠ¸.getRange(2, 1, uploadData.length, headers.length).setValues(uploadData);
      
      // ìš”ì•½ ì •ë³´
      const ìš”ì•½í–‰ = uploadData.length + 3;
      ì—…ë¡œë“œì‹œíŠ¸.getRange(ìš”ì•½í–‰, 1).setValue('ğŸ“Š ì—…ë¡œë“œ ìš”ì•½');
      ì—…ë¡œë“œì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 1, 1).setValue(`ì´ ${ë³€ê²½ì œí’ˆëª©ë¡.size}ê°œ ìƒí’ˆ`);
      ì—…ë¡œë“œì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 2, 1).setValue(`ì´ ${uploadData.length}ê°œ í–‰`);
      ì—…ë¡œë“œì‹œíŠ¸.getRange(ìš”ì•½í–‰ + 3, 1).setValue('âš ï¸ ê° ìƒí’ˆì˜ ëª¨ë“  ì˜µì…˜ì´ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
      
      ui.alert(`âœ… ë©”ì´í¬ìƒµ ì—…ë¡œë“œ íŒŒì¼ ìƒì„± ì™„ë£Œ!\n\n` +
              `${ë³€ê²½ì œí’ˆëª©ë¡.size}ê°œ ìƒí’ˆì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
              `âš ï¸ ì£¼ì˜: ê° ìƒí’ˆì˜ ëª¨ë“  ì˜µì…˜ì´ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.\n` +
              `ë³€ê²½ë˜ì§€ ì•Šì€ ì˜µì…˜ë„ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.`);
    } else {
      ui.alert('â„¹ï¸ ì—…ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
    
  } catch (error) {
    console.error('ì˜¤ë¥˜:', error);
    ui.alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.toString());
  }
}

// ========== ì‹œíŠ¸ ì •ë¦¬ ê¸°ëŠ¥ ==========
function organizeSheets() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  try {
    // í•„ìˆ˜ ì‹œíŠ¸ ìˆœì„œ ì •ì˜
    const í•„ìˆ˜ì‹œíŠ¸ìˆœì„œ = [
      CONFIG.ì›ë³¸ë°ì´í„°ì‹œíŠ¸,
      CONFIG.ê°€ê²©ìˆ˜ì •ì‹œíŠ¸,
      CONFIG.ì‹­ì¼€ì´ë°ì´í„°ì‹œíŠ¸,
      CONFIG.ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸,
      CONFIG.ì˜µì…˜ê²€ì¦ì‹œíŠ¸,
      '10Kê²€ì¦ê²°ê³¼',
      CONFIG.ë¯¸ë§¤ì¹­ì›ë³¸ì‹œíŠ¸,
      CONFIG.ë³€ê²½ë‚´ì—­ì‹œíŠ¸,
      CONFIG.ë³€ë™ë¥ ê²€ì¦ì‹œíŠ¸,
      CONFIG.ë©”ì´í¬ìƒµì—…ë¡œë“œì‹œíŠ¸
    ];
    
    // ì‹œíŠ¸ ìˆœì„œ ì¬ì •ë ¬
    í•„ìˆ˜ì‹œíŠ¸ìˆœì„œ.forEach((sheetName, index) => {
      const sheet = ss.getSheetByName(sheetName);
      if (sheet) {
        ss.setActiveSheet(sheet);
        ss.moveActiveSheet(index + 1);
      }
    });
    
    ui.alert('âœ… ì‹œíŠ¸ ì •ë¦¬ ì™„ë£Œ!');
    
  } catch (error) {
    ui.alert('âŒ ì˜¤ë¥˜: ' + error.toString());
  }
}

// ========== ì „ì²´ ë¦¬í¬íŠ¸ ìƒì„± ==========
function generateFullReport() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  const sheets = ss.getSheets();
  let report = 'ğŸ“Š ë©”ì´í¬ìƒµ ê°€ê²© ê´€ë¦¬ ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸\n\n';
  
  // ì‹œíŠ¸ë³„ ìš”ì•½
  report += 'ğŸ“‹ ì‹œíŠ¸ í˜„í™©:\n';
  sheets.forEach(sheet => {
    const name = sheet.getName();
    const lastRow = sheet.getLastRow();
    const lastCol = sheet.getLastColumn();
    if (!sheet.isSheetHidden()) {
      report += `- ${name}: ${lastRow}í–‰ Ã— ${lastCol}ì—´\n`;
    }
  });
  
  // 14K/18K ê²€ì¦ ê²°ê³¼ ìš”ì•½
  const ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì˜µì…˜ê²€ì¦ì‹œíŠ¸);
  if (ê²€ì¦ì‹œíŠ¸ && ê²€ì¦ì‹œíŠ¸.getLastRow() > 1) {
    const data = ê²€ì¦ì‹œíŠ¸.getDataRange().getValues();
    let ì¼ì¹˜ = 0, ë¶ˆì¼ì¹˜ = 0, ë¯¸ë§¤ì¹­ = 0;
    
    for (let i = 1; i < data.length; i++) {
      const ìƒíƒœ = data[i][2];
      if (ìƒíƒœ === 'âœ… ì¼ì¹˜') ì¼ì¹˜++;
      else if (ìƒíƒœ === 'âš ï¸ ë¶ˆì¼ì¹˜') ë¶ˆì¼ì¹˜++;
      else if (ìƒíƒœ === 'âŒ ë¯¸ë§¤ì¹­') ë¯¸ë§¤ì¹­++;
    }
    
    report += `\nğŸ“Š 14K/18K ê²€ì¦ ê²°ê³¼:\n`;
    report += `- ì¼ì¹˜: ${ì¼ì¹˜}ê°œ\n`;
    report += `- ë¶ˆì¼ì¹˜: ${ë¶ˆì¼ì¹˜}ê°œ\n`;
    report += `- ë¯¸ë§¤ì¹­: ${ë¯¸ë§¤ì¹­}ê°œ\n`;
  }
  
  // 10K ê²€ì¦ ê²°ê³¼ ìš”ì•½
  const ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸ = ss.getSheetByName('10Kê²€ì¦ê²°ê³¼');
  if (ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸ && ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸.getLastRow() > 1) {
    const data = ì‹­ì¼€ì´ê²€ì¦ì‹œíŠ¸.getDataRange().getValues();
    let ì¼ì¹˜ = 0, ë¶ˆì¼ì¹˜ = 0, ë¯¸ë§¤ì¹­ = 0;
    
    for (let i = 1; i < data.length; i++) {
      const ìƒíƒœ = data[i][3];
      if (ìƒíƒœ === 'âœ… ì¼ì¹˜') ì¼ì¹˜++;
      else if (ìƒíƒœ === 'âš ï¸ ë¶ˆì¼ì¹˜') ë¶ˆì¼ì¹˜++;
      else if (ìƒíƒœ === 'âŒ ë¯¸ë§¤ì¹­') ë¯¸ë§¤ì¹­++;
    }
    
    report += `\nğŸ“Š 10K ê²€ì¦ ê²°ê³¼:\n`;
    report += `- ì¼ì¹˜: ${ì¼ì¹˜}ê°œ\n`;
    report += `- ë¶ˆì¼ì¹˜: ${ë¶ˆì¼ì¹˜}ê°œ\n`;
    report += `- ë¯¸ë§¤ì¹­: ${ë¯¸ë§¤ì¹­}ê°œ\n`;
  }
  
  // ë³€ê²½ì‚¬í•­ ìš”ì•½
  const ë³€ê²½ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ë³€ê²½ë‚´ì—­ì‹œíŠ¸);
  if (ë³€ê²½ì‹œíŠ¸ && ë³€ê²½ì‹œíŠ¸.getLastRow() > 1) {
    const ë³€ê²½ê±´ìˆ˜ = ë³€ê²½ì‹œíŠ¸.getLastRow() - 1;
    report += `\nğŸ“ ê°€ê²© ë³€ê²½ì‚¬í•­:\n`;
    report += `- ì´ ${ë³€ê²½ê±´ìˆ˜}ê°œ ì˜µì…˜ ê°€ê²© ë³€ê²½ (10,000ì› ì´ˆê³¼ ì°¨ì´)\n`;
  }
  
  report += `\nâš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •:\n`;
  report += `- í—ˆìš©ì˜¤ì°¨: 10,000ì›\n`;
  report += `- í• ì¸ìœ¨: 30% (ê³ ì •)\n`;
  report += `- 10K ì œí’ˆ: ë³„ë„ ì²˜ë¦¬\n`;
  report += `- ì—…ë¡œë“œ: ë³€ê²½ëœ ìƒí’ˆì˜ ëª¨ë“  ì˜µì…˜ í¬í•¨\n`;
  report += `- ë²”ìœ„ ì§€ì •: Aì—´ ê¸°ì¤€ ë²ˆí˜¸ë¡œ íŠ¹ì • ë²”ìœ„ë§Œ ì²˜ë¦¬ ê°€ëŠ¥\n`;
  
  ui.alert('ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸', report, ui.ButtonSet.OK);
}

// ========== ë¶ˆí•„ìš”í•œ ì‹œíŠ¸ ì‚­ì œ ==========
function cleanupSheets() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  const response = ui.alert(
    'âš ï¸ ì£¼ì˜',
    'ë°±ì—…, ì„ì‹œ, ë³µì‚¬ë³¸ ì‹œíŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
    ui.ButtonSet.YES_NO
  );
  
  if (response === ui.Button.YES) {
    const sheets = ss.getSheets();
    let ì‚­ì œìˆ˜ = 0;
    
    sheets.forEach(sheet => {
      const name = sheet.getName();
      if (name.includes('ë°±ì—…') || 
          name.includes('ì„ì‹œ') ||
          name.includes('ë³µì‚¬ë³¸') ||
          name.includes('Copy of')) {
        ss.deleteSheet(sheet);
        ì‚­ì œìˆ˜++;
      }
    });
    
    ui.alert(`âœ… ${ì‚­ì œìˆ˜}ê°œ ì‹œíŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }
}

// ========== í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ==========
function createTestData() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const ui = SpreadsheetApp.getUi();
  
  const response = ui.alert(
    'ğŸ§ª í…ŒìŠ¤íŠ¸',
    'í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ê°€ê²©ìˆ˜ì •íŒŒì¼ì˜ ì œí’ˆ ê°€ê²©ì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' +
    '14K/18K:\n' +
    '- 1ë²ˆ ì œí’ˆ: 10% ì¸ìƒ\n' +
    '- 2ë²ˆ ì œí’ˆ: 10% í• ì¸ ì ìš©\n\n' +
    '10K:\n' +
    '- 1ë²ˆ ì œí’ˆ: 5% ì¸ìƒ',
    ui.ButtonSet.YES_NO
  );
  
  if (response === ui.Button.YES) {
    // 14K/18K í…ŒìŠ¤íŠ¸ ë°ì´í„°
    const ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    
    if (ê°€ê²©ì‹œíŠ¸) {
      // 1ë²ˆ ì œí’ˆì˜ 3í–‰ ìˆ˜ì • (10% ì¸ìƒ)
      for (let i = 1; i <= 3; i++) {
        // Oì—´ (14K ì¿ í°ê°€)
        const cell14K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 15); // Oì—´
        const value14K = cell14K.getValue();
        if (value14K && typeof value14K === 'number') {
          cell14K.setValue(Math.round(value14K * 1.1));
          cell14K.setBackground('#ffff00');
        }
        
        // ACì—´ (18K ì¿ í°ê°€)
        const cell18K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 29); // ACì—´
        const value18K = cell18K.getValue();
        if (value18K && typeof value18K === 'number') {
          cell18K.setValue(Math.round(value18K * 1.1));
          cell18K.setBackground('#ffff00');
        }
      }
      
      // 2ë²ˆ ì œí’ˆì˜ 3í–‰ ìˆ˜ì • (10% í• ì¸ìœ¼ë¡œ ë³€ê²½)
      if (ê°€ê²©ì‹œíŠ¸.getLastRow() >= 7) {
        for (let i = 4; i <= 6; i++) {
          // Mì—´ì˜ ì •ìƒê°€ë¥¼ ì½ì–´ì„œ 90%ë¡œ Oì—´ì— ì„¤ì •
          const normal14K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 13).getValue(); // Mì—´
          if (normal14K && typeof normal14K === 'number') {
            const cell14K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 15); // Oì—´
            cell14K.setValue(Math.ceil((normal14K * 0.9) / 1000) * 1000); // 10% í• ì¸, ì²œì›ë‹¨ìœ„ ì˜¬ë¦¼
            cell14K.setBackground('#87ceeb'); // í•˜ëŠ˜ìƒ‰
          }
          
          // AAì—´ì˜ ì •ìƒê°€ë¥¼ ì½ì–´ì„œ 90%ë¡œ ACì—´ì— ì„¤ì •
          const normal18K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 27).getValue(); // AAì—´
          if (normal18K && typeof normal18K === 'number') {
            const cell18K = ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 29); // ACì—´
            cell18K.setValue(Math.ceil((normal18K * 0.9) / 1000) * 1000); // 10% í• ì¸, ì²œì›ë‹¨ìœ„ ì˜¬ë¦¼
            cell18K.setBackground('#87ceeb'); // í•˜ëŠ˜ìƒ‰
          }
        }
      }
    }
    
    // 10K í…ŒìŠ¤íŠ¸ ë°ì´í„°
    const ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸ = ss.getSheetByName(CONFIG.ì‹­ì¼€ì´ê°€ê²©ìˆ˜ì •ì‹œíŠ¸);
    
    if (ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸) {
      // 1ë²ˆ ì œí’ˆì˜ 3í–‰ ìˆ˜ì • (5% ì¸ìƒ)
      for (let i = 1; i <= 3; i++) {
        // Oì—´ (10K ì¿ í°ê°€)
        const cell10K = ì‹­ì¼€ì´ê°€ê²©ì‹œíŠ¸.getRange(i + 1, 15); // Oì—´
        const value10K = cell10K.getValue();
        if (value10K && typeof value10K === 'number') {
          cell10K.setValue(Math.round(value10K * 1.05));
          cell10K.setBackground('#FFD700'); // ê¸ˆìƒ‰
        }
      }
    }
    
    ui.alert(`âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ\n\n` +
            `14K/18K:\n` +
            `- 1ë²ˆ ì œí’ˆ: 10% ì¸ìƒ (ë…¸ë€ìƒ‰)\n` +
            `- 2ë²ˆ ì œí’ˆ: 10% í• ì¸ ì ìš© (í•˜ëŠ˜ìƒ‰)\n\n` +
            `10K:\n` +
            `- 1ë²ˆ ì œí’ˆ: 5% ì¸ìƒ (ê¸ˆìƒ‰)\n\n` +
            `ì´ì œ 'ë²”ìœ„ ì§€ì • ê°€ê²© ê²€ì¦'ì„ ì‹¤í–‰í•´ë³´ì„¸ìš”.\n` +
            `ì˜ˆ: 1-2 ì…ë ¥í•˜ì—¬ 1~2ë²ˆ ì œí’ˆë§Œ ê²€ì¦`);
  }
}
